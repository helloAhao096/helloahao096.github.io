import{_ as a,c as i,o as t,a0 as n}from"./chunks/framework.DXI-tbPr.js";const g=JSON.parse('{"title":"Flutter 项目架构与开发手册","description":"面向 Flutter 初学者的完整项目架构设计指南，包含目录结构、核心工具概念（Riverpod、Dio、GoRouter、freezed 等）、分层架构与数据流，帮助你从零构建可维护的 Flutter 应用。","frontmatter":{"title":"Flutter 项目架构与开发手册","description":"面向 Flutter 初学者的完整项目架构设计指南，包含目录结构、核心工具概念（Riverpod、Dio、GoRouter、freezed 等）、分层架构与数据流，帮助你从零构建可维护的 Flutter 应用。","date":"2025-02-06T00:00:00.000Z","tags":["Flutter","Dart","移动开发","工程化"]},"headers":[],"relativePath":"posts/Flutter 项目架构与开发手册.md","filePath":"posts/Flutter 项目架构与开发手册.md","lastUpdated":1770359472000}'),e={name:"posts/Flutter 项目架构与开发手册.md"};function l(p,s,h,r,d,k){return t(),i("div",null,[...s[0]||(s[0]=[n(`<blockquote><p>本文面向有编程经验但 Flutter 零基础的开发者，提供结构清晰、层次分明的项目架构与开发手册。涵盖目录设计、核心工具概念、数据流与快速上手，可作为日常开发的参考手册。</p></blockquote><p><strong>适用场景</strong>：本架构面向<strong>中大型项目</strong>（多人协作、功能模块较多、需长期维护）。若为个人小项目或简单 CRUD，可大幅简化：如仅保留 <code>lib/screens/</code> + <code>lib/services/</code>，或省略 Domain 层，按需裁剪。</p><p><strong>如何评估项目规模</strong>：可从以下维度综合判断，满足多数「小」则偏小，满足多数「大」则偏大，介于中间则偏中。</p><table tabindex="0"><thead><tr><th>维度</th><th>小</th><th>中</th><th>大</th></tr></thead><tbody><tr><td><strong>团队</strong></td><td>1 人</td><td>2～5 人</td><td>5+ 人 / 多团队</td></tr><tr><td><strong>功能模块</strong></td><td>1～3 个（如登录+列表+详情）</td><td>4～10 个</td><td>10+ 个，多领域</td></tr><tr><td><strong>页面数量</strong></td><td>5 屏以内</td><td>5～25 屏</td><td>25+ 屏</td></tr><tr><td><strong>业务复杂度</strong></td><td>简单 CRUD，无复杂规则</td><td>有流程、状态机、多数据源</td><td>强领域逻辑、离线、同步</td></tr><tr><td><strong>维护周期</strong></td><td>短期（周～月）</td><td>数月～1 年</td><td>长期（年+）</td></tr><tr><td><strong>数据层</strong></td><td>单一 API 或本地</td><td>API + 本地缓存</td><td>多源、离线优先、复杂同步</td></tr></tbody></table><p><strong>架构裁剪建议</strong>：小项目用 <code>screens/</code> + <code>services/</code> 即可；中项目采用本文完整结构；大项目可考虑将 feature 拆为独立 package，或引入更多领域划分。</p><hr><h2 id="一、flutter-核心概念速览" tabindex="-1">一、Flutter 核心概念速览 <a class="header-anchor" href="#一、flutter-核心概念速览" aria-label="Permalink to &quot;一、Flutter 核心概念速览&quot;">​</a></h2><p>在进入架构之前，先理解 Flutter 的底层思维，便于你快速建立心智模型。</p><h3 id="_1-1-一切皆-widget" tabindex="-1">1.1 一切皆 Widget <a class="header-anchor" href="#_1-1-一切皆-widget" aria-label="Permalink to &quot;1.1 一切皆 Widget&quot;">​</a></h3><p>Flutter 的 UI 由 <strong>Widget</strong> 组成，类似于 Vue 的组件、React 的 Component。</p><table tabindex="0"><thead><tr><th>概念</th><th>类比</th><th>说明</th></tr></thead><tbody><tr><td><strong>Widget</strong></td><td>Vue 组件 / React 组件</td><td>UI 的构建块，可以是按钮、文本、布局容器</td></tr><tr><td><strong>StatefulWidget</strong></td><td>有状态的组件</td><td>内部有可变数据，数据变化会触发重建</td></tr><tr><td><strong>StatelessWidget</strong></td><td>无状态组件</td><td>纯展示，无内部可变状态</td></tr><tr><td><strong>BuildContext</strong></td><td>Vue 的 <code>this</code> / React 的 context</td><td>当前 Widget 在树中的位置，用于获取主题、路由等</td></tr></tbody></table><p><strong>关键理解</strong>：Widget 是<strong>不可变的</strong>（immutable）。要更新 UI，不是修改 Widget，而是用新数据<strong>重建</strong> Widget 树。状态管理（如 Riverpod）的本质，就是「谁持有数据、谁触发重建」。</p><h3 id="_1-2-dart-语言要点-有经验者可略读" tabindex="-1">1.2 Dart 语言要点（有经验者可略读） <a class="header-anchor" href="#_1-2-dart-语言要点-有经验者可略读" aria-label="Permalink to &quot;1.2 Dart 语言要点（有经验者可略读）&quot;">​</a></h3><ul><li><strong>空安全</strong>：变量默认非空，需显式加 <code>?</code> 表示可空，如 <code>String? name</code></li><li><strong>异步</strong>：<code>Future</code> 类似 Promise，<code>async/await</code> 语法与 JS 一致</li><li><strong>没有 <code>new</code></strong>：<code>User()</code> 即可，<code>new</code> 可选</li><li><strong>级联操作符</strong>：<code>obj..a = 1..b = 2</code> 连续调用，返回原对象</li></ul><hr><h2 id="二、项目目录结构-完整版" tabindex="-1">二、项目目录结构（完整版） <a class="header-anchor" href="#二、项目目录结构-完整版" aria-label="Permalink to &quot;二、项目目录结构（完整版）&quot;">​</a></h2><p>基于 <strong>Core / Shared / Features</strong> 混合模式 + <strong>Data / Domain / Presentation</strong> 分层，推荐结构如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>lib/</span></span>
<span class="line"><span>├── main.dart                    # 入口：初始化 App、Provider、Router</span></span>
<span class="line"><span>├── app.dart                     # 根组件：Theme、Router 配置</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── core/                        # 核心基础设施（框架级，与业务无关）</span></span>
<span class="line"><span>│   ├── config/                  # 环境配置</span></span>
<span class="line"><span>│   │   └── env.dart</span></span>
<span class="line"><span>│   ├── network/                 # 网络层</span></span>
<span class="line"><span>│   │   ├── dio_client.dart      # Dio 封装</span></span>
<span class="line"><span>│   │   └── api_interceptor.dart # 拦截器（Token、错误处理）</span></span>
<span class="line"><span>│   ├── router/                  # 路由</span></span>
<span class="line"><span>│   │   └── app_router.dart</span></span>
<span class="line"><span>│   ├── theme/                   # 主题</span></span>
<span class="line"><span>│   │   └── app_theme.dart</span></span>
<span class="line"><span>│   ├── location/                # 定位能力（设备级）</span></span>
<span class="line"><span>│   │   └── location_service.dart</span></span>
<span class="line"><span>│   ├── utils/                   # 纯工具函数</span></span>
<span class="line"><span>│   │   └── validators.dart</span></span>
<span class="line"><span>│   └── exceptions/              # 全局异常定义</span></span>
<span class="line"><span>│       └── app_exception.dart</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── shared/                      # 共享层（跨 Feature 复用）</span></span>
<span class="line"><span>│   ├── components/              # 通用 UI 组件</span></span>
<span class="line"><span>│   │   ├── app_button.dart</span></span>
<span class="line"><span>│   │   ├── app_loading.dart</span></span>
<span class="line"><span>│   │   └── app_error_widget.dart</span></span>
<span class="line"><span>│   ├── models/                  # 通用数据模型</span></span>
<span class="line"><span>│   │   └── user.dart</span></span>
<span class="line"><span>│   └── services/                # 通用服务（多 Feature 共用时放入）</span></span>
<span class="line"><span>│       └── storage_service.dart</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└── features/                    # 业务模块（按功能领域划分）</span></span>
<span class="line"><span>    ├── auth/                    # 示例：认证模块</span></span>
<span class="line"><span>    │   ├── data/                # 数据层</span></span>
<span class="line"><span>    │   │   ├── dtos/            # 数据传输对象（API JSON 结构）</span></span>
<span class="line"><span>    │   │   │   └── login_dto.dart</span></span>
<span class="line"><span>    │   │   ├── datasources/</span></span>
<span class="line"><span>    │   │   │   ├── remote/      # 远程 API</span></span>
<span class="line"><span>    │   │   │   │   └── auth_remote_datasource.dart</span></span>
<span class="line"><span>    │   │   │   └── local/       # 本地存储（缓存、DB）</span></span>
<span class="line"><span>    │   │   │       └── auth_local_datasource.dart</span></span>
<span class="line"><span>    │   │   └── repositories/</span></span>
<span class="line"><span>    │   │       └── auth_repository_impl.dart</span></span>
<span class="line"><span>    │   │</span></span>
<span class="line"><span>    │   ├── domain/              # 领域层（按需添加，见 2.1 节）</span></span>
<span class="line"><span>    │   │   ├── entities/        # 业务实体</span></span>
<span class="line"><span>    │   │   │   └── user_entity.dart</span></span>
<span class="line"><span>    │   │   └── repositories/    # 仓储接口（抽象，简单模块可省略）</span></span>
<span class="line"><span>    │   │       └── auth_repository.dart</span></span>
<span class="line"><span>    │   │</span></span>
<span class="line"><span>    │   └── presentation/        # 表现层</span></span>
<span class="line"><span>    │       ├── providers/        # Riverpod Provider 定义</span></span>
<span class="line"><span>    │       │   └── auth_providers.dart</span></span>
<span class="line"><span>    │       ├── controllers/     # 状态逻辑（Notifier）</span></span>
<span class="line"><span>    │       │   └── auth_controller.dart</span></span>
<span class="line"><span>    │       ├── pages/            # 页面（Scaffold）</span></span>
<span class="line"><span>    │       │   ├── login_page.dart</span></span>
<span class="line"><span>    │       │   └── register_page.dart</span></span>
<span class="line"><span>    │       └── widgets/         # 模块内私有组件</span></span>
<span class="line"><span>    │           └── login_form.dart</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── map/                     # 示例：地图模块</span></span>
<span class="line"><span>        ├── data/</span></span>
<span class="line"><span>        ├── domain/</span></span>
<span class="line"><span>        └── presentation/</span></span></code></pre></div><h3 id="_2-1-domain-层何时引入-yagni" tabindex="-1">2.1 Domain 层何时引入（YAGNI） <a class="header-anchor" href="#_2-1-domain-层何时引入-yagni" aria-label="Permalink to &quot;2.1 Domain 层何时引入（YAGNI）&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>建议</th></tr></thead><tbody><tr><td><strong>简单 CRUD、单一数据源</strong></td><td>可省略 domain，data 层直接提供 Repository 实现类，presentation 直接依赖</td></tr><tr><td><strong>需 Mock 测试、多数据源切换</strong></td><td>引入 domain 层，定义 Repository 接口，data 实现</td></tr><tr><td><strong>复杂业务规则、多实体协作</strong></td><td>引入完整 domain 层（entities + 接口）</td></tr></tbody></table><p><strong>原则</strong>：默认可不建 domain，仅在「需要抽象」时再引入，避免过度设计。</p><h3 id="_2-2-目录职责速查表" tabindex="-1">2.2 目录职责速查表 <a class="header-anchor" href="#_2-2-目录职责速查表" aria-label="Permalink to &quot;2.2 目录职责速查表&quot;">​</a></h3><table tabindex="0"><thead><tr><th>目录</th><th>职责</th><th>依赖方向</th></tr></thead><tbody><tr><td><code>core/</code></td><td>框架配置、网络、路由、主题、定位</td><td>被所有层依赖</td></tr><tr><td><code>shared/</code></td><td>跨 Feature 的组件、模型、服务</td><td>被 features 依赖</td></tr><tr><td><code>features/*/data/</code></td><td>获取与持久化数据（API、DB）</td><td>实现 domain 接口</td></tr><tr><td><code>features/*/domain/</code></td><td>业务实体与仓储接口</td><td>无依赖（最纯粹）</td></tr><tr><td><code>features/*/presentation/</code></td><td>UI、状态、用户交互</td><td>依赖 domain</td></tr></tbody></table><hr><h2 id="三、核心工具与概念详解" tabindex="-1">三、核心工具与概念详解 <a class="header-anchor" href="#三、核心工具与概念详解" aria-label="Permalink to &quot;三、核心工具与概念详解&quot;">​</a></h2><p>以下工具是构建现代 Flutter 项目的标配，理解它们能大幅提升开发效率。</p><h3 id="_3-1-riverpod-——-依赖注入与状态管理" tabindex="-1">3.1 Riverpod —— 依赖注入与状态管理 <a class="header-anchor" href="#_3-1-riverpod-——-依赖注入与状态管理" aria-label="Permalink to &quot;3.1 Riverpod —— 依赖注入与状态管理&quot;">​</a></h3><p><strong>是什么</strong>：Riverpod 是 Flutter 官方推荐的<strong>状态管理 + 依赖注入</strong>方案，可类比为 Vue 的 Pinia + 全局 DI 容器。</p><p><strong>核心概念</strong>：</p><table tabindex="0"><thead><tr><th>概念</th><th>说明</th><th>类比</th></tr></thead><tbody><tr><td><strong>Provider</strong></td><td>声明「如何创建/获取」某个对象或状态</td><td>Vue 的 <code>provide/inject</code>、FastAPI 的 <code>Depends</code></td></tr><tr><td><strong>ref.watch</strong></td><td>监听 Provider，数据变化时自动重建 Widget</td><td>Vue 的 <code>computed</code> / <code>watch</code></td></tr><tr><td><strong>ref.read</strong></td><td>一次性读取，不监听变化</td><td>直接调用</td></tr><tr><td><strong>Notifier</strong></td><td>持有状态并处理业务逻辑的类</td><td>Vue 的 Store、Pinia store</td></tr><tr><td><strong>AsyncNotifier</strong></td><td>处理异步状态（加载中/成功/失败）</td><td>带 loading/error 的 Store</td></tr></tbody></table><p><strong>典型用法</strong>：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. 定义 Provider（依赖注入）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authRepositoryProvider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((ref) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dioProvider);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AuthRepositoryImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dio);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. 定义状态 Provider（状态管理）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authControllerProvider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NotifierProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AuthController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AsyncValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?&gt;&gt;(() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AuthController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 在 Widget 中使用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LoginPage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ConsumerWidget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  @override</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Widget</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BuildContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WidgetRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authControllerProvider);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自动注入 + 监听</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authState.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      loading</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CircularProgressIndicator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e, _) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;错误: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (user) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HomePage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LoginForm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>为什么选 Riverpod</strong>：一个工具同时解决「谁创建对象」和「谁持有状态」，减少样板代码，与 Flutter 3 生态契合。</p><p><strong>推荐：Riverpod Generator（代码生成）</strong></p><p>使用 <code>@riverpod</code> 注解可自动生成 Provider，减少手写样板，是当前更流行的写法：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 @riverpod 注解，运行 build_runner 后自动生成 authRepositoryProvider</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@riverpod</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AuthRepository</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> authRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AuthRepositoryRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dioProvider);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AuthRepositoryImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dio);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AsyncNotifier 自动生成 provider</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@riverpod</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AuthController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _$AuthController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  @override</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Future</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Future</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">login</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> email, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> password) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AsyncLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AsyncValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">guard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ref.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authRepositoryProvider).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">login</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(email, password));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在 Widget 中用法不变：<code>ref.watch(authControllerProvider)</code>。需在 <code>pubspec.yaml</code> 添加 <code>riverpod_generator</code>，并运行 <code>dart run build_runner build</code>。</p><hr><h3 id="_3-2-dio-——-http-客户端" tabindex="-1">3.2 Dio —— HTTP 客户端 <a class="header-anchor" href="#_3-2-dio-——-http-客户端" aria-label="Permalink to &quot;3.2 Dio —— HTTP 客户端&quot;">​</a></h3><p><strong>是什么</strong>：Dart 最流行的 HTTP 库，类似 Axios，支持拦截器、超时、取消等。</p><p><strong>在项目中的位置</strong>：<code>core/network/dio_client.dart</code>，封装单例，供各 Repository 使用。</p><p><strong>典型封装</strong>：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// core/network/dio_client.dart</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dioProvider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((ref) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BaseOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    baseUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.apiBaseUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    connectTimeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(seconds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dio.interceptors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AuthInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Token 注入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dio.interceptors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LogInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求日志</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dio;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><strong>与 Repository 的关系</strong>：Repository 通过 <code>ref.watch(dioProvider)</code> 获取 Dio 实例，调用 <code>dio.get(&#39;/users&#39;)</code> 等，不直接在各处 new Dio。</p><hr><h3 id="_3-3-gorouter-——-声明式路由" tabindex="-1">3.3 GoRouter —— 声明式路由 <a class="header-anchor" href="#_3-3-gorouter-——-声明式路由" aria-label="Permalink to &quot;3.3 GoRouter —— 声明式路由&quot;">​</a></h3><p><strong>是什么</strong>：Flutter 官方推荐的声明式路由库，支持深层链接、路由守卫、嵌套路由。</p><p><strong>核心概念</strong>：</p><table tabindex="0"><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td><strong>GoRoute</strong></td><td>定义一条路由（path、页面、子路由）</td></tr><tr><td><strong>GoRouter</strong></td><td>路由配置的根对象</td></tr><tr><td><strong>context.go(&#39;/path&#39;)</strong></td><td>跳转并替换栈</td></tr><tr><td><strong>context.push(&#39;/path&#39;)</strong></td><td>压栈跳转</td></tr><tr><td><strong>redirect</strong></td><td>路由守卫，如未登录跳转登录页</td></tr></tbody></table><p><strong>典型配置</strong>：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// core/router/app_router.dart</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goRouter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GoRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialLocation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  redirect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (context, state) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLoggedIn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* 从 Riverpod 读取 */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLoginRoute </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.matchedLocation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isLoggedIn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isLoginRoute) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不重定向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  routes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GoRoute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_, __) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LoginPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GoRoute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/home&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_, __) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HomePage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><hr><h3 id="_3-4-freezed-——-不可变数据类" tabindex="-1">3.4 freezed —— 不可变数据类 <a class="header-anchor" href="#_3-4-freezed-——-不可变数据类" aria-label="Permalink to &quot;3.4 freezed —— 不可变数据类&quot;">​</a></h3><p><strong>是什么</strong>：代码生成库，自动生成 <code>copyWith</code>、<code>==</code>、<code>hashCode</code>、<code>toString</code>，让数据类不可变且易用。</p><p><strong>为什么需要</strong>：Dart 没有 data class，手写上述方法繁琐且易错。freezed 类似 Kotlin 的 <code>data class</code>、TypeScript 的 <code>interface</code> + 工具函数。</p><p><strong>典型用法</strong>：</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 定义</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@freezed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _$User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> factory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    required</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    required</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> avatar,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  factory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromJson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dynamic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; json) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _$UserFromJson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(json);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Alice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updated </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copyWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Bob&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 新对象，原对象不变</span></span></code></pre></div><hr><h3 id="_3-5-json-serializable-——-json-序列化" tabindex="-1">3.5 json_serializable —— JSON 序列化 <a class="header-anchor" href="#_3-5-json-serializable-——-json-序列化" aria-label="Permalink to &quot;3.5 json_serializable —— JSON 序列化&quot;">​</a></h3><p><strong>是什么</strong>：配合 freezed 或单独使用，自动生成 <code>fromJson</code> / <code>toJson</code>，处理 API 返回的 JSON。</p><p><strong>与 freezed 配合</strong>：在 freezed 类中加 <code>factory User.fromJson(...)</code>，运行 <code>dart run build_runner build</code> 生成 <code>*.g.dart</code>、<code>*.freezed.dart</code>。</p><p><strong>DTO 与 Entity</strong>：从 API 拿到的用 DTO（字段可与后端一致），转换后得到 Entity（面向 UI 的干净模型）。转换逻辑放在 Repository。</p><hr><h3 id="_3-6-其他常用工具" tabindex="-1">3.6 其他常用工具 <a class="header-anchor" href="#_3-6-其他常用工具" aria-label="Permalink to &quot;3.6 其他常用工具&quot;">​</a></h3><table tabindex="0"><thead><tr><th>工具</th><th>用途</th></tr></thead><tbody><tr><td><strong>logger</strong></td><td>统一日志格式，可过滤级别</td></tr><tr><td><strong>shared_preferences</strong></td><td>键值对本地存储（类似 localStorage）</td></tr><tr><td><strong>geolocator</strong></td><td>定位（GPS）</td></tr><tr><td><strong>google_maps_flutter</strong> / <strong>flutter_map</strong></td><td>地图组件</td></tr></tbody></table><hr><h2 id="四、数据流与分层协作" tabindex="-1">四、数据流与分层协作 <a class="header-anchor" href="#四、数据流与分层协作" aria-label="Permalink to &quot;四、数据流与分层协作&quot;">​</a></h2><p>理解「数据从哪来、往哪去」，是写好架构的关键。</p><h3 id="_4-1-数据流向图" tabindex="-1">4.1 数据流向图 <a class="header-anchor" href="#_4-1-数据流向图" aria-label="Permalink to &quot;4.1 数据流向图&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户操作 → Page/Widget</span></span>
<span class="line"><span>            ↓</span></span>
<span class="line"><span>        Controller (Notifier)  ← ref.watch(controllerProvider)</span></span>
<span class="line"><span>            ↓ 调用</span></span>
<span class="line"><span>        Repository (接口)</span></span>
<span class="line"><span>            ↓ 实现</span></span>
<span class="line"><span>        RemoteDataSource / LocalDataSource</span></span>
<span class="line"><span>            ↓</span></span>
<span class="line"><span>        API (Dio) / 本地 DB</span></span></code></pre></div><h3 id="_4-2-各层职责" tabindex="-1">4.2 各层职责 <a class="header-anchor" href="#_4-2-各层职责" aria-label="Permalink to &quot;4.2 各层职责&quot;">​</a></h3><table tabindex="0"><thead><tr><th>层级</th><th>职责</th><th>不做什么</th></tr></thead><tbody><tr><td><strong>Page</strong></td><td>展示 UI、响应用户操作、调用 Controller</td><td>不直接调 API、不写业务逻辑</td></tr><tr><td><strong>Controller</strong></td><td>持有状态、调用 Repository、处理加载/错误</td><td>不解析 JSON、不关心数据从哪来</td></tr><tr><td><strong>Repository</strong></td><td>协调 DataSource、DTO→Entity 转换</td><td>不持有 UI 状态</td></tr><tr><td><strong>DataSource</strong></td><td>发起 HTTP 请求、读写本地存储</td><td>不处理业务规则</td></tr></tbody></table><h3 id="_4-3-依赖方向-clean-architecture" tabindex="-1">4.3 依赖方向（Clean Architecture） <a class="header-anchor" href="#_4-3-依赖方向-clean-architecture" aria-label="Permalink to &quot;4.3 依赖方向（Clean Architecture）&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Presentation → Domain ← Data</span></span>
<span class="line"><span>     ↓            ↑</span></span>
<span class="line"><span>   (依赖)      (实现接口)</span></span></code></pre></div><ul><li><strong>Domain</strong>：最内层，无外部依赖，只有实体和接口</li><li><strong>Data</strong>：实现 Domain 的 Repository 接口</li><li><strong>Presentation</strong>：依赖 Domain 接口，通过 Riverpod 注入具体实现</li></ul><h3 id="_4-4-错误处理策略" tabindex="-1">4.4 错误处理策略 <a class="header-anchor" href="#_4-4-错误处理策略" aria-label="Permalink to &quot;4.4 错误处理策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>层级</th><th>策略</th><th>示例</th></tr></thead><tbody><tr><td><strong>全局</strong></td><td>Dio 拦截器统一捕获网络错误，可弹 SnackBar 或记录日志</td><td>401 自动跳转登录、500 统一提示</td></tr><tr><td><strong>局部</strong></td><td>Controller 用 <code>AsyncValue</code> 持有 error，Page 用 <code>state.when(error: ...)</code> 展示</td><td>列表加载失败显示重试按钮</td></tr><tr><td><strong>重试</strong></td><td>在 Repository 或 DataSource 层封装重试逻辑（如 <code>dio_retry</code> 包）</td><td>网络抖动时自动重试 1～2 次</td></tr><tr><td><strong>业务异常</strong></td><td>定义 <code>AppException</code>（如 <code>AuthException</code>、<code>NetworkException</code>），在 Repository 抛出，Controller 捕获后转为用户友好文案</td><td>密码错误 →「账号或密码不正确」</td></tr></tbody></table><p><strong>原则</strong>：全局拦截器处理「通用」错误（如 Token 过期）；业务相关错误在 Controller 层处理，便于针对不同页面做差异化展示。</p><hr><h2 id="五、开发环境与日常流程-纯-fvm" tabindex="-1">五、开发环境与日常流程（纯 FVM） <a class="header-anchor" href="#五、开发环境与日常流程-纯-fvm" aria-label="Permalink to &quot;五、开发环境与日常流程（纯 FVM）&quot;">​</a></h2><p><strong>思路</strong>：仅用 FVM 管理 Flutter，不单独安装 Flutter SDK。FVM 按项目下载并切换 Flutter 版本。</p><h3 id="_5-1-安装-fvm" tabindex="-1">5.1 安装 FVM <a class="header-anchor" href="#_5-1-安装-fvm" aria-label="Permalink to &quot;5.1 安装 FVM&quot;">​</a></h3><table tabindex="0"><thead><tr><th>平台</th><th>操作</th></tr></thead><tbody><tr><td><strong>Windows</strong></td><td>打开 <a href="https://github.com/leoafarias/fvm/releases" target="_blank" rel="noreferrer">GitHub Releases</a>，下载对应平台的包（如 <code>fvm-x.x.x-windows-x64.zip</code>），解压后将 <code>bin</code> 加入 PATH；若无 Windows 包可用 <code>choco install fvm</code></td></tr><tr><td><strong>macOS</strong></td><td><code>brew tap leoafarias/fvm &amp;&amp; brew install fvm</code></td></tr></tbody></table><h3 id="_5-2-使用流程" tabindex="-1">5.2 使用流程 <a class="header-anchor" href="#_5-2-使用流程" aria-label="Permalink to &quot;5.2 使用流程&quot;">​</a></h3><table tabindex="0"><thead><tr><th>步骤</th><th>命令</th></tr></thead><tbody><tr><td>进入项目</td><td><code>cd my_app</code></td></tr><tr><td>指定版本</td><td><code>fvm use stable</code> 或 <code>fvm use 3.24.0</code>（首次自动下载 Flutter）</td></tr><tr><td>日常命令</td><td><code>fvm flutter run</code>、<code>fvm flutter pub get</code>、<code>fvm dart run build_runner build</code> 等</td></tr></tbody></table><p><strong>Git</strong>：提交 <code>.fvmrc</code>，不提交 <code>.fvm/flutter_sdk</code>。团队拉代码后执行 <code>fvm install</code> 同步版本。</p><h3 id="_5-3-常用命令速查" tabindex="-1">5.3 常用命令速查 <a class="header-anchor" href="#_5-3-常用命令速查" aria-label="Permalink to &quot;5.3 常用命令速查&quot;">​</a></h3><table tabindex="0"><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>新建项目</td><td><code>fvm flutter create my_app</code></td></tr><tr><td>安装依赖</td><td><code>fvm flutter pub get</code></td></tr><tr><td>代码生成</td><td><code>fvm dart run build_runner build</code></td></tr><tr><td>运行</td><td><code>fvm flutter run</code></td></tr><tr><td>构建</td><td><code>fvm flutter build apk</code> / <code>fvm flutter build ios</code></td></tr><tr><td>分析</td><td><code>fvm flutter analyze</code></td></tr></tbody></table><h3 id="_5-4-常见问题" tabindex="-1">5.4 常见问题 <a class="header-anchor" href="#_5-4-常见问题" aria-label="Permalink to &quot;5.4 常见问题&quot;">​</a></h3><table tabindex="0"><thead><tr><th>问题</th><th>处理</th></tr></thead><tbody><tr><td>团队版本不一致</td><td><code>fvm install</code></td></tr><tr><td>网络慢</td><td>配置 <code>PUB_HOSTED_URL</code>、<code>FLUTTER_STORAGE_BASE_URL</code> 镜像</td></tr></tbody></table><hr><h2 id="六、快速上手指南" tabindex="-1">六、快速上手指南 <a class="header-anchor" href="#六、快速上手指南" aria-label="Permalink to &quot;六、快速上手指南&quot;">​</a></h2><h3 id="_6-1-新建项目与依赖" tabindex="-1">6.1 新建项目与依赖 <a class="header-anchor" href="#_6-1-新建项目与依赖" aria-label="Permalink to &quot;6.1 新建项目与依赖&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fvm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flutter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my_app</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my_app</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fvm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stable</span></span></code></pre></div><p>在 <code>pubspec.yaml</code> 中添加：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  flutter_riverpod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  riverpod_annotation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.3.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  dio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^5.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  go_router</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^13.0.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  freezed_annotation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  json_annotation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^4.8.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dev_dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build_runner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  riverpod_generator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.3.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  freezed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  json_serializable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^6.7.0</span></span></code></pre></div><p>执行 <code>fvm flutter pub get</code>。</p><h3 id="_6-2-创建目录结构" tabindex="-1">6.2 创建目录结构 <a class="header-anchor" href="#_6-2-创建目录结构" aria-label="Permalink to &quot;6.2 创建目录结构&quot;">​</a></h3><p>按第二节的目录结构，先创建 <code>core/</code>、<code>shared/</code>、<code>features/auth/</code> 等空目录和占位文件，再逐步实现。</p><h3 id="_6-3-最小闭环-登录流程" tabindex="-1">6.3 最小闭环：登录流程 <a class="header-anchor" href="#_6-3-最小闭环-登录流程" aria-label="Permalink to &quot;6.3 最小闭环：登录流程&quot;">​</a></h3><ol><li><strong>core/network</strong>：封装 Dio，配置 baseUrl</li><li><strong>features/auth/data</strong>：定义 <code>LoginDto</code>、<code>AuthRemoteDataSource</code>、<code>AuthRepositoryImpl</code></li><li><strong>features/auth/domain</strong>：定义 <code>User</code> 实体、<code>AuthRepository</code> 接口</li><li><strong>features/auth/presentation</strong>：<code>AuthController</code>（调用 Repository）、<code>LoginPage</code>（表单 + 调用 Controller）</li><li><strong>core/router</strong>：配置 <code>/login</code>、<code>/home</code>，在 <code>main.dart</code> 中挂载 <code>ProviderScope</code> 和 <code>MaterialApp.router</code></li></ol><p>完成上述步骤，即可跑通「输入账号密码 → 调 API → 跳转首页」的完整流程。</p><h3 id="_6-4-代码生成命令" tabindex="-1">6.4 代码生成命令 <a class="header-anchor" href="#_6-4-代码生成命令" aria-label="Permalink to &quot;6.4 代码生成命令&quot;">​</a></h3><p>修改 freezed/json_serializable 相关文件后，运行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fvm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build_runner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或监听模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fvm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build_runner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> watch</span></span></code></pre></div><hr><h2 id="七、测试目录结构" tabindex="-1">七、测试目录结构 <a class="header-anchor" href="#七、测试目录结构" aria-label="Permalink to &quot;七、测试目录结构&quot;">​</a></h2><p>建议与 <code>lib/</code> 镜像对应：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>test/</span></span>
<span class="line"><span>├── core/</span></span>
<span class="line"><span>├── shared/</span></span>
<span class="line"><span>└── features/</span></span>
<span class="line"><span>    └── auth/</span></span>
<span class="line"><span>        ├── data/</span></span>
<span class="line"><span>        ├── domain/</span></span>
<span class="line"><span>        └── presentation/</span></span></code></pre></div><ul><li><strong>单元测试</strong>：Repository、Controller、工具函数</li><li><strong>Widget 测试</strong>：单个 Widget 的渲染与交互</li><li><strong>集成测试</strong>：完整流程（如登录到首页）</li></ul><hr><h2 id="八、设计原则回顾" tabindex="-1">八、设计原则回顾 <a class="header-anchor" href="#八、设计原则回顾" aria-label="Permalink to &quot;八、设计原则回顾&quot;">​</a></h2><table tabindex="0"><thead><tr><th>原则</th><th>实践</th></tr></thead><tbody><tr><td><strong>YAGNI</strong></td><td>不预先创建空模块，Domain 层按需引入，小项目可简化结构</td></tr><tr><td><strong>单一职责</strong></td><td>每层、每文件职责明确</td></tr><tr><td><strong>依赖倒置</strong></td><td>Presentation 依赖 Domain 接口（若有），不依赖 Data 实现</td></tr><tr><td><strong>模块内聚</strong></td><td>一个 Feature 内的代码尽量自包含</td></tr><tr><td><strong>DRY</strong></td><td>共享组件/模型放 shared，简单场景 DTO 与 Entity 可合并</td></tr></tbody></table><hr><h2 id="八、延伸阅读" tabindex="-1">八、延伸阅读 <a class="header-anchor" href="#八、延伸阅读" aria-label="Permalink to &quot;八、延伸阅读&quot;">​</a></h2><ul><li><a href="https://riverpod.dev" target="_blank" rel="noreferrer">Riverpod 官方文档</a></li><li><a href="https://pub.dev/packages/go_router" target="_blank" rel="noreferrer">GoRouter 官方文档</a></li><li><a href="https://pub.dev/packages/freezed" target="_blank" rel="noreferrer">freezed 文档</a></li><li><a href="https://docs.flutter.dev/data-and-backend/state-mgmt/options" target="_blank" rel="noreferrer">Flutter 官方架构文档</a></li></ul><hr><blockquote><p>本文档随项目演进可持续补充。建议将「目录结构」和「工具概念」部分作为日常开发的速查手册使用。</p></blockquote>`,118)])])}const c=a(e,[["render",l]]);export{g as __pageData,c as default};
