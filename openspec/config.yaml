schema: spec-driven

# Project context (optional)
# This is shown to AI when creating artifacts.
# Add your tech stack, conventions, style guides, domain knowledge, etc.
# Example:
#   context: |
#     Tech stack: TypeScript, React, Node.js
#     We use conventional commits
#     Domain: e-commerce platform

context: |
  你正在为一个基于 VitePress 的中文站点仓库工作。

  ## 站点与目录结构（真实约定）
  - 站点根目录为 `docs/`
  - 博客文章目录为 `docs/posts/`
  - 博客列表页为 `docs/posts/index.md`，其 frontmatter 需要设置 `sidebar: false`
  - VitePress 配置：`docs/.vitepress/config.ts`
  - 自定义主题代码：`docs/.vitepress/theme/`

  ## 路由/侧边栏生成逻辑（与代码一致）
  - 文章会通过 `docs/.vitepress/theme/utils/posts.ts` 扫描 `posts/` 下的所有 `.md`（排除 `posts/index.md`）
  - `frontmatter.date` 会被归一化，并用于按年份分组生成 sidebar
  - 站点启用了 `cleanUrls: "with-subfolders"`，sidebar 链接会去掉 `.html` 后缀

  ## 文章 frontmatter 约定（请尽量遵守）
  - 每篇文章建议包含：
    - `title`: string（必填）
    - `description`: string（建议）
    - `date`: string（建议：`YYYY-MM-DD HH:mm:ss` 或至少 `YYYY-MM-DD`）
    - `tags`: string[]（建议，且遵循「少而精、尽量复用」原则）
  - `docs/posts/index.md` 需要：
    - `sidebar: false`
    - `title: 博客`

  ## posts 写作流程（必须遵守）
  - 当用户给出一个 post 的「概念」时，**先不创建博客文章（post）的 md 文件**（即不创建 `docs/posts/*.md`；OpenSpec 的 proposal/design/tasks 等产物 md 不受此限）。
  - 第一步：自底向上拆解与分析，按第一性原理思考——要让读者从头到尾形成体系化理解，需要哪些前置知识、核心概念、步骤与结论。
  - 第二步：输出「大纲」（至少到 H2，必要时到 H3）和「编写思路」（各章节目的、阅读顺序、关键衔接），供用户确认。
  - 第三步：**仅在用户明确确认大纲与编写思路之后**，才创建 post 文章的 md（`docs/posts/*.md`）并开始内容的细化和撰写。

  ## 写作与排版偏好
  - 语言：简体中文
  - 文章结构：优先用二级/三级标题组织内容，先给读者“适用场景/前置条件/步骤/验证/排错”
  - 代码块：标注语言（bash/shell/json/yaml/ts/vue 等），命令可复制即用
  - 图表：在必要章节可使用 Mermaid 图表（流程图、时序图、类图等）对内容做补充说明；站点已启用 vitepress-plugin-mermaid，可直接在 md 中写 ```mermaid 代码块。

  ## 代码修改范围与标准（Vue3 + VitePress）
  - 主要改动会发生在：
    - `docs/.vitepress/config.ts`
    - `docs/.vitepress/theme/**/*`（Vue SFC + TypeScript 工具代码）
  - 修改原则：
    - 保持 TypeScript 类型清晰、可维护
    - 遵循现有项目风格（导入、命名、目录分层）
    - 优先小步可回滚的改动，避免不必要的重构

# Per-artifact rules (optional)
# Add custom rules for specific artifacts.
# Example:
#   rules:
#     proposal:
#       - Keep proposals under 500 words
#       - Always include a "Non-goals" section
#     tasks:
#       - Break tasks into chunks of max 2 hours

rules:
  proposal:
    - 本仓库的变更主要分两类：写 `docs/posts/*.md` 文章，或修改 `docs/.vitepress/**` 代码。提案必须先明确属于哪一类（或两类都有）。
    - 必须包含 "Goals" 与 "Non-goals"。
    - 写文章类提案：先对用户给出的 post 概念做自底向上拆解与第一性原理分析，输出大纲与编写思路供确认；**在用户确认前不创建、不写入 post 文章的 md**（即不创建 `docs/posts/*.md`；OpenSpec 的 proposal/design/tasks 等 md 照常可创建）。确认后再给出目标落盘路径与预计 frontmatter（至少 title/date/tags）。
    - 改代码类提案必须点名涉及的文件/目录（例如 `docs/.vitepress/theme/utils/posts.ts`），并说明对路由、sidebar、主题组件的影响面。
    - 若会影响文章列表/sidebar 生成逻辑，必须说明对 `frontmatter.date/title` 缺失时的行为预期。

  design:
    - 写文章类：必须先产出「大纲」（至少到 H2，必要时到 H3）和「编写思路」（各节目的、阅读顺序、衔接关系），并明确“步骤/验证/排错”是否需要；该产出仅供用户确认，确认通过后才进入「创建 post 文章的 md（`docs/posts/*.md`）与细化内容」阶段。
    - 改代码类：给出最小实现方案（MVP），并列出至少 2 条备选方案或不采用的理由（如果确实没有备选，说明原因）。
    - 涉及数据结构（如 Post 类型、frontmatter 字段）变化时，必须写清楚迁移策略与兼容性（旧文章是否需要补字段）。

  tasks:
    - 任务必须按“可交付物”拆分，单个任务建议 0.5–2 小时可完成。
    - 写文章类：凡涉及新建或大幅改写 post 文章（`docs/posts/*.md`）的任务，**仅在大纲与编写思路已获用户确认之后**才执行「创建/更新 post 文章的 md」和「内容细化」；未确认前不创建、不写入 post 文章的 md（与 OpenSpec 的 proposal/design/tasks 等 md 无关）。
    - 写文章类任务必须包含：
      - 新增/更新的 markdown 文件清单（`docs/posts/...`）
      - frontmatter 检查项（title/date/tags/description），其中 tags 需要：
        - 优先复用历史已有的 tag，不随意创造新 tag
        - 仅在确有必要区分主题时才新增 tag
        - 控制单篇文章的 tag 数量，避免堆叠过多不必要标签
      - 站内链接/资源引用检查（`docs/public/` 静态资源路径）
    - 改代码类任务必须包含：
      - 具体文件级改动点（文件路径 + 变更摘要）
      - 验收方式（本地启动、页面路径、期望行为）
      - 风险与回滚（如何恢复到改动前）
