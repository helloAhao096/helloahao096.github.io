import{_ as i,c as a,o as t,a0 as n}from"./chunks/framework.DXI-tbPr.js";const o=JSON.parse('{"title":"giscus 评论插件配置指南","description":"从启用 GitHub Discussions 到在 VitePress 中完成 giscus 评论集成的完整流程","frontmatter":{"title":"giscus 评论插件配置指南","description":"从启用 GitHub Discussions 到在 VitePress 中完成 giscus 评论集成的完整流程","date":"2025-11-26T18:29:00.000Z","tags":["博客搭建","giscus","VitePress"]},"headers":[],"relativePath":"posts/giscus评论配置.md","filePath":"posts/giscus评论配置.md","lastUpdated":1764310147000}'),e={name:"posts/giscus评论配置.md"};function h(l,s,p,k,d,E){return t(),a("div",null,[...s[0]||(s[0]=[n(`<blockquote><p>这篇文章记录了我将博客评论系统从 Gitalk 迁移到 giscus 的全过程，涵盖仓库准备、环境变量、组件集成与常见问题排查，适合直接复制到自己的 VitePress 站点。</p></blockquote><h2 id="_1-为什么选择-giscus" tabindex="-1">1. 为什么选择 giscus <a class="header-anchor" href="#_1-为什么选择-giscus" aria-label="Permalink to &quot;1. 为什么选择 giscus&quot;">​</a></h2><ul><li>✅ 基于 GitHub Discussions，评论内容天然可搜索、可订阅。</li><li>✅ 不再需要 OAuth App 与 <code>clientSecret</code>，部署更安全。</li><li>✅ 支持多语言与暗色主题，可通过 <code>data-theme</code>/props 实时切换。</li><li>✅ 官方提供 React/Vue/Svelte 组件，也可以直接用 Web Component。</li></ul><h2 id="_2-仓库侧准备" tabindex="-1">2. 仓库侧准备 <a class="header-anchor" href="#_2-仓库侧准备" aria-label="Permalink to &quot;2. 仓库侧准备&quot;">​</a></h2><ol><li><strong>开启 Discussions</strong><br> 进入评论存储仓库（可以是站点本身，也可以是单独仓库），<code>Settings → General → Features</code> 勾选 <code>Discussions</code>。</li><li><strong>安装 giscus App</strong><br> 打开 <a href="https://github.com/apps/giscus" target="_blank" rel="noreferrer">github.com/apps/giscus</a> → <code>Install</code> → 选择当前仓库。若是组织仓库，需要拥有者授予权限。</li><li><strong>创建分类</strong><br> 在仓库 <code>Discussions</code> 页左侧点击 <code>Categories</code> 的铅笔图标，创建一个分类（例如 <code>Blog Comments</code>）。后续每篇文章的讨论都会落在这个分类里。</li></ol><h2 id="_3-giscus-app-生成配置" tabindex="-1">3. giscus.app 生成配置 <a class="header-anchor" href="#_3-giscus-app-生成配置" aria-label="Permalink to &quot;3. giscus.app 生成配置&quot;">​</a></h2><p>访问 <a href="https://giscus.app" target="_blank" rel="noreferrer">https://giscus.app</a>：</p><ul><li><strong>Repository</strong>：选择授权的仓库（<code>owner/repo</code>）</li><li><strong>Discussion Category</strong>：选择要存放评论的分类</li><li><strong>Mapping</strong>：决定如何匹配页面与讨论（支持 <code>pathname</code>、<code>url</code>、<code>title</code>、<code>og:title</code>、<code>number</code>、<code>specific</code> 等）</li><li><strong>strict</strong>：<code>0/1</code> 控制是否严格匹配（<code>1</code> 表示没有讨论时不会自动创建）</li><li><strong>reactions-enabled</strong>：<code>1/0</code> 控制是否展示 GitHub Reactions</li><li><strong>emit-metadata</strong>：<code>1/0</code> 控制是否向父页面发送 metadata 事件</li><li><strong>input-position</strong>：<code>top/bottom</code> 决定评论框位置</li><li><strong>theme</strong>：内置 <code>light</code>、<code>dark</code>、<code>preferred_color_scheme</code>、<code>transparent_dark</code> 等，也支持自定义主题 URL</li><li><strong>lang</strong>：界面语言（支持 <code>zh-CN</code>、<code>en</code> 等 30+ 语言）</li><li><strong>loading</strong>：<code>lazy/eager</code> 控制加载策略</li><li><strong>allowFullScreen</strong>：允许 iframe 全屏（与 <code>data-allowfullscreen</code> 对应）</li><li><strong>crossorigin / origin</strong>：限制允许加载来源（防盗链）</li></ul><p>页面右侧会生成一段 <code>&lt;script&gt;</code>，其中包含：</p><ul><li><code>data-repo</code> / <code>data-repo-id</code></li><li><code>data-category</code> / <code>data-category-id</code></li><li><code>data-mapping</code> / <code>data-strict</code> / <code>data-reactions-enabled</code> 等</li></ul><p>把这些值抄下来，后面写入 <code>.env</code>。</p><h2 id="_4-环境变量与-vite-配置" tabindex="-1">4. 环境变量与 Vite 配置 <a class="header-anchor" href="#_4-环境变量与-vite-配置" aria-label="Permalink to &quot;4. 环境变量与 Vite 配置&quot;">​</a></h2><p>在 <code>docs/.env.local</code>（或 <code>docs/.env</code>）写入：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_REPO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">owner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">repo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_REPO_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">repo_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_CATEGORY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">category_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_CATEGORY_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">category_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_MAPPING</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pathname</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_STRICT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_REACTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_EMIT_METADATA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_INPUT_POSITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bottom</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_THEME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">preferred_color_scheme</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_THEME_DARK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">transparent_dark</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_GISCUS_LANG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">zh-CN</span></span></code></pre></div><blockquote><p>⚠️ 重点：VitePress 的根目录是 <code>docs/</code>，所以 <code>.env</code> 也要放在 <code>docs/</code>，否则不会注入 <code>import.meta.env</code>。</p></blockquote><p>如果想把 <code>.env</code> 放在仓库根，可以在 <code>docs/.vitepress/config.ts</code> 里加入：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vite: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    envDir: process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cwd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 让 Vite 读取仓库根目录下的 env</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="_5-主题层集成" tabindex="-1">5. 主题层集成 <a class="header-anchor" href="#_5-主题层集成" aria-label="Permalink to &quot;5. 主题层集成&quot;">​</a></h2><p>在 <code>docs/.vitepress/theme/constants/index.ts</code> 中导出 <code>GISCUS_CONFIG</code>，将上面环境变量映射为常量：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> viteEnv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ImportMeta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; }).env </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GISCUS_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  repo: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_REPO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  repoId: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_REPO_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  category: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_CATEGORY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  categoryId: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_CATEGORY_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mapping: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_MAPPING</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;pathname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  strict: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_STRICT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reactionsEnabled: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_REACTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  emitMetadata: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_EMIT_METADATA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  inputPosition: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_INPUT_POSITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bottom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  theme: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_THEME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;light&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  themeDark: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_THEME_DARK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;transparent_dark&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lang: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_LANG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;zh-CN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  loading: viteEnv.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_GISCUS_LOADING</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lazy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="_6-vue-组件挂载方式" tabindex="-1">6. Vue 组件挂载方式 <a class="header-anchor" href="#_6-vue-组件挂载方式" aria-label="Permalink to &quot;6. Vue 组件挂载方式&quot;">​</a></h2><p>项目使用官方的 <code>@giscus/vue</code> 组件，核心逻辑在 <code>docs/.vitepress/theme/components/plugin/Comments.vue</code>（也可以使用 Web Component，自行传入 <code>data-*</code> 属性）：</p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Giscus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> v-if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isClient</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">routeKey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v-bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">giscusProps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Giscus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@giscus/vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { computed, ref, watch, onMounted } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useData } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vitepress&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { GISCUS_CONFIG } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;../../constants&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isDark</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> routeKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> giscusProps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> computed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;comments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  repo: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.repo,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  repoId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.repoId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  category: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.category,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  categoryId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.categoryId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mapping: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.mapping,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  strict: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.strict,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reactionsEnabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.reactionsEnabled,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  emitMetadata: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.emitMetadata,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  inputPosition: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.inputPosition,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  theme: isDark.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.themeDark </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.theme,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lang: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.lang,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  loading: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GISCUS_CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.loading,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.value.relativePath,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (routeKey.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { immediate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onMounted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isClient.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 避免 SSR 阶段挂载 giscus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>关键点：</p><ul><li>使用 <code>routeKey</code> 监听 <code>page.relativePath</code>，切换文章时强制刷新评论。</li><li>利用 <code>isDark</code> 计算主题，确保深浅色模式自动同步。</li><li><code>isClient</code> 避免 SSR 渲染时访问浏览器 API。</li></ul><h2 id="_7-本地与-ci-调试" tabindex="-1">7. 本地与 CI 调试 <a class="header-anchor" href="#_7-本地与-ci-调试" aria-label="Permalink to &quot;7. 本地与 CI 调试&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:dev</span></span></code></pre></div><ul><li>若控制台报 “giscus is not installed”，说明 giscus App 没授权到当前仓库或 <code>repoId</code> 来自其他仓库。</li><li>若请求参数仍显示 <code>your-github-username/your-repo</code>，说明 <code>.env</code> 没被读取，请检查文件位置或 <code>vite.envDir</code>。</li></ul><p>CI 场景（如 GitHub Actions）可在 workflow 中添加：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  VITE_GISCUS_REPO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.VITE_GISCUS_REPO }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  VITE_GISCUS_REPO_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.VITE_GISCUS_REPO_ID }}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 其余变量同理</span></span></code></pre></div><h3 id="_7-1-在-github-中添加-secrets" tabindex="-1">7.1 在 GitHub 中添加 Secrets <a class="header-anchor" href="#_7-1-在-github-中添加-secrets" aria-label="Permalink to &quot;7.1 在 GitHub 中添加 Secrets&quot;">​</a></h3><ol><li>打开仓库 → <code>Settings</code> → 左侧 <code>Secrets and variables</code> → <code>Actions</code>。</li><li>点击 <code>New repository secret</code>，依次创建： <ul><li><code>VITE_GISCUS_REPO</code></li><li><code>VITE_GISCUS_REPO_ID</code></li><li><code>VITE_GISCUS_CATEGORY</code></li><li><code>VITE_GISCUS_CATEGORY_ID</code></li><li>其他需要的 <code>VITE_GISCUS_*</code> 字段</li></ul></li><li>在 GitHub Actions workflow（例如 <code>deploy-pages.yml</code>）中通过 <code>env</code> 或 <code>with.env</code> 引用这些 secrets，构建时 <code>import.meta.env</code> 就能拿到对应值。</li></ol><blockquote><p>如果多个仓库共用同一套 giscus 参数，可在组织级 Secrets 中统一配置，然后在 workflow 中引用 <code>secrets.ORG_SECRET_NAME</code>。</p></blockquote><h2 id="_8-常见问题排查" tabindex="-1">8. 常见问题排查 <a class="header-anchor" href="#_8-常见问题排查" aria-label="Permalink to &quot;8. 常见问题排查&quot;">​</a></h2><table tabindex="0"><thead><tr><th>问题</th><th>处理办法</th></tr></thead><tbody><tr><td><code>giscus is not installed on this repository</code></td><td>重新安装 giscus App，并确认 <code>VITE_GISCUS_REPO</code> 与授权仓库一致。</td></tr><tr><td>403 Forbidden 且请求参数为默认值</td><td><code>.env</code> 未被读取，把文件放到 <code>docs/</code> 或设置 <code>envDir</code>。</td></tr><tr><td>暗色主题不生效</td><td>检查 <code>theme</code>、<code>themeDark</code> 是否填入 giscus 支持的主题名称，并确认 <code>isDark</code> 是否响应。</td></tr><tr><td>Discussions 未自动创建</td><td>先在页面提交第一条评论，giscus 会自动建讨论；若失败，手动在仓库 Discussions 下创建同名讨论确认映射。</td></tr></tbody></table><h2 id="_9-giscus-vs-gitalk" tabindex="-1">9. giscus VS Gitalk <a class="header-anchor" href="#_9-giscus-vs-gitalk" aria-label="Permalink to &quot;9. giscus VS Gitalk&quot;">​</a></h2><table tabindex="0"><thead><tr><th>对比项</th><th>giscus</th><th>Gitalk</th></tr></thead><tbody><tr><td>数据存储</td><td>GitHub Discussions</td><td>GitHub Issues</td></tr><tr><td>授权方式</td><td>安装 giscus App（无需 clientSecret）</td><td>需要 GitHub OAuth App + clientID/clientSecret</td></tr><tr><td>repo / 分类</td><td>支持同仓库多分类（Category）</td><td>单仓库 Issues，通常额外开评论仓库</td></tr><tr><td>映射方式</td><td><code>pathname</code> / <code>url</code> / <code>title</code> / <code>number</code> 等</td><td>需要手动生成 <code>id</code>，长度 &lt; 50</td></tr><tr><td>组件支持</td><td>提供 React / Vue / Svelte / Web Component</td><td>仅提供 Web Widget</td></tr><tr><td>明暗主题</td><td>内置多个主题，可通过 props/<code>postMessage</code> 动态切换</td><td>仅支持 CSS 覆盖，切换需要重新渲染</td></tr><tr><td>Reactions / Metadata</td><td>内建，可配置</td><td>需要依赖 Issues 原生的 reactions</td></tr><tr><td>访问者体验</td><td>可直接在 Discussions 中查看/参与，支持实时刷新</td><td>基于 Issues，不支持原生 Discussions 功能</td></tr></tbody></table><p>迁移时可按以下策略：</p><ol><li>在原评论仓库开启 Discussions，或新建一个专门用于 giscus 的仓库。</li><li>如果原 Issue 中有历史评论，可手动将 Issue 转换为 Discussion（GitHub 支持迁移），确保标题或 pathname 与 giscus 映射保持一致。</li><li>在站点中替换 <code>Comments.vue</code> 逻辑，并更新 <code>.env</code> 为 giscus 所需的变量。</li><li>验证新的讨论能否在 <code>Blog Comments</code> 分类下自动创建，再决定是否关闭旧的 Gitalk 初始化代码。</li></ol><h2 id="_9-总结" tabindex="-1">9. 总结 <a class="header-anchor" href="#_9-总结" aria-label="Permalink to &quot;9. 总结&quot;">​</a></h2><p>切换到 giscus 之后，评论体验和维护成本都大幅降低：不再需要独立仓库维护 Issues，也不用管理 OAuth 密钥。只要按本文流程准备好 Discussions、安装 giscus App，并把生成的参数放进 <code>.env</code>，就能在 VitePress 中即时启用。希望这份笔记能帮助你在自己的博客里顺利部署 giscus！</p>`,41)])])}const c=i(e,[["render",h]]);export{o as __pageData,c as default};
