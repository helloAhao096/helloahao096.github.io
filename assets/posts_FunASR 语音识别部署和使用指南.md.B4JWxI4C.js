import{_ as d,C as o,c as r,o as a,a0 as t,b as l,w as i,a as e,G as h,a2 as p}from"./chunks/framework.DXI-tbPr.js";const B=JSON.parse('{"title":"FunASR 语音识别部署和使用指南","description":"FunASR 离线文件转写服务 Docker 部署指南和 WebSocket 通信协议详解","frontmatter":{"title":"FunASR 语音识别部署和使用指南","description":"FunASR 离线文件转写服务 Docker 部署指南和 WebSocket 通信协议详解","date":"2026-01-27T00:00:00.000Z","tags":["ASR"]},"headers":[],"relativePath":"posts/FunASR 语音识别部署和使用指南.md","filePath":"posts/FunASR 语音识别部署和使用指南.md","lastUpdated":1769500945000}'),k={name:"posts/FunASR 语音识别部署和使用指南.md"};function E(g,s,c,F,u,C){const n=o("Mermaid");return a(),r("div",null,[s[6]||(s[6]=t('<blockquote><p>FunASR 是阿里巴巴达摩院开源的语音识别框架，提供离线文件转写和实时语音识别服务。本文档介绍 FunASR 的识别模式、部署方式选择、SDK 部署实践，以及 WebSocket 通信协议的详细说明。</p></blockquote><h2 id="一、funasr-简介" tabindex="-1">一、FunASR 简介 <a class="header-anchor" href="#一、funasr-简介" aria-label="Permalink to &quot;一、FunASR 简介&quot;">​</a></h2><p>FunASR 是一个完整的语音识别解决方案，集成了语音端点检测（VAD）、语音识别（ASR）、标点预测（PUNC）等模型，可以将音频识别成带标点的文字，支持上百路并发请求。</p><h3 id="核心特性" tabindex="-1">核心特性 <a class="header-anchor" href="#核心特性" aria-label="Permalink to &quot;核心特性&quot;">​</a></h3><ul><li><strong>完整的语音识别链路</strong>：集成 VAD、ASR、PUNC 等模型</li><li><strong>支持多种音视频格式</strong>：服务端集成 ffmpeg，支持 pcm、mp3、mp4 等多种格式</li><li><strong>高性能</strong>：支持上百路请求同时进行转写</li><li><strong>丰富的输出</strong>：输出为带标点的文字，含有字级别时间戳，支持 ITN（逆文本规范化）与用户自定义热词</li><li><strong>多语言客户端</strong>：提供 html、python、c++、java 与 c# 等多种编程语言客户端</li></ul><h2 id="二、识别模式详解" tabindex="-1">二、识别模式详解 <a class="header-anchor" href="#二、识别模式详解" aria-label="Permalink to &quot;二、识别模式详解&quot;">​</a></h2><p>FunASR 支持三种识别模式，每种模式适用于不同的使用场景。理解这些模式的区别，有助于选择最适合的方案。</p><h3 id="_2-1-offline-模式-离线文件转写" tabindex="-1">2.1 offline 模式（离线文件转写） <a class="header-anchor" href="#_2-1-offline-模式-离线文件转写" aria-label="Permalink to &quot;2.1 offline 模式（离线文件转写）&quot;">​</a></h3><p><strong>工作原理：</strong></p><ul><li>客户端发送完整的音频数据后，服务端等待所有数据接收完毕</li><li>服务端对完整音频进行一次性识别处理</li><li>只返回一次识别结果（<code>is_final: False</code>）</li></ul><p><strong>特点：</strong></p><ul><li>✅ <strong>延迟低</strong>：不需要实时处理，可以批量处理</li><li>✅ <strong>准确度高</strong>：基于完整音频上下文，识别更准确</li><li>✅ <strong>资源占用少</strong>：不需要维护实时连接状态</li><li>❌ <strong>无实时反馈</strong>：必须等待音频全部发送完毕才能得到结果</li></ul><p><strong>适用场景：</strong></p><ul><li>录音后识别（微信式录音）</li><li>文件转写（mp3、mp4 等音频文件）</li><li>批量音频处理</li></ul><p><strong>返回值特点：</strong></p><ul><li><code>mode: &quot;offline&quot;</code></li><li><code>is_final: False</code>（<strong>注意：虽然为 False，但服务端只会返回一次结果，这实际上就是最终结果</strong>）</li><li>返回完整的识别文本</li></ul><p><strong>工作流程：</strong></p>',17)),(a(),l(p,null,{default:i(()=>[h(n,{id:"mermaid-138",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20Client%20as%20%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%20%20%20%20participant%20Server%20as%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%3Cbr%2F%3E(mode%3A%20%22offline%22)%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E5%AE%8C%E6%95%B4%E9%9F%B3%E9%A2%91%E6%95%B0%E6%8D%AE%3Cbr%2F%3E(%E4%BA%8C%E8%BF%9B%E5%88%B6)%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E7%BB%93%E6%9D%9F%E6%A0%87%E5%BF%97%3Cbr%2F%3E(is_speaking%3A%20false)%0A%20%20%20%20Note%20over%20Server%3A%20%E7%AD%89%E5%BE%85%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E6%8E%A5%E6%94%B6%E5%AE%8C%E6%AF%95%0A%20%20%20%20Note%20over%20Server%3A%20%E4%B8%80%E6%AC%A1%E6%80%A7%E8%AF%86%E5%88%AB%E5%A4%84%E7%90%86%0A%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C%3Cbr%2F%3E(is_final%3A%20false%2C%20%E5%94%AF%E4%B8%80%E7%BB%93%E6%9E%9C)%0A"})]),fallback:i(()=>[...s[0]||(s[0]=[e(" Loading... ",-1)])]),_:1})),s[7]||(s[7]=t('<h3 id="_2-2-online-模式-实时语音识别" tabindex="-1">2.2 online 模式（实时语音识别） <a class="header-anchor" href="#_2-2-online-模式-实时语音识别" aria-label="Permalink to &quot;2.2 online 模式（实时语音识别）&quot;">​</a></h3><p><strong>工作原理：</strong></p><ul><li>客户端持续发送音频流（chunk by chunk）</li><li>服务端实时处理每个音频片段</li><li>持续返回中间结果（<code>is_final: false</code>），最后返回最终结果（<code>is_final: true</code>）</li></ul><p><strong>特点：</strong></p><ul><li>✅ <strong>实时反馈</strong>：边说话边显示识别结果</li><li>✅ <strong>低延迟</strong>：每个音频片段立即处理</li><li>❌ <strong>准确度相对较低</strong>：基于部分音频上下文，可能不够准确</li><li>❌ <strong>资源占用高</strong>：需要维护实时连接和状态</li></ul><p><strong>适用场景：</strong></p><ul><li>实时语音输入（类似语音输入法）</li><li>语音直播字幕</li><li>需要即时反馈的场景</li></ul><p><strong>返回值特点：</strong></p><ul><li><code>mode: &quot;online&quot;</code></li><li>持续返回 <code>is_final: false</code> 的中间结果</li><li>最后返回 <code>is_final: true</code> 的最终结果</li><li>文本内容逐步完善</li></ul><p><strong>工作流程：</strong></p>',10)),(a(),l(p,null,{default:i(()=>[h(n,{id:"mermaid-235",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20Client%20as%20%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%20%20%20%20participant%20Server%20as%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%3Cbr%2F%3E(mode%3A%20%22online%22%2C%20chunk_size)%0A%20%20%20%20%0A%20%20%20%20loop%20%E6%8C%81%E7%BB%AD%E5%8F%91%E9%80%81%E9%9F%B3%E9%A2%91%E6%B5%81%0A%20%20%20%20%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E9%9F%B3%E9%A2%91%E7%89%87%E6%AE%B5%3Cbr%2F%3E(%E4%BA%8C%E8%BF%9B%E5%88%B6%20chunk)%0A%20%20%20%20%20%20%20%20Note%20over%20Server%3A%20%E5%AE%9E%E6%97%B6%E5%A4%84%E7%90%86%E9%9F%B3%E9%A2%91%E7%89%87%E6%AE%B5%0A%20%20%20%20%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%E4%B8%AD%E9%97%B4%E7%BB%93%E6%9E%9C%3Cbr%2F%3E(is_final%3A%20false)%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E7%BB%93%E6%9D%9F%E6%A0%87%E5%BF%97%3Cbr%2F%3E(is_speaking%3A%20false)%0A%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C%3Cbr%2F%3E(is_final%3A%20true)%0A"})]),fallback:i(()=>[...s[1]||(s[1]=[e(" Loading... ",-1)])]),_:1})),s[8]||(s[8]=t('<h3 id="_2-3-2pass-模式-两遍识别" tabindex="-1">2.3 2pass 模式（两遍识别） <a class="header-anchor" href="#_2-3-2pass-模式-两遍识别" aria-label="Permalink to &quot;2.3 2pass 模式（两遍识别）&quot;">​</a></h3><p><strong>工作原理：</strong></p><ul><li>结合了 <code>online</code> 和 <code>offline</code> 两种模式</li><li>首先实时返回识别结果（<code>2pass-online</code>，<code>is_final: false</code>）</li><li>在句尾或音频结束时，使用离线模型进行修正（<code>2pass-offline</code>，<code>is_final: true</code>）</li></ul><p><strong>特点：</strong></p><ul><li>✅ <strong>兼顾实时性和准确度</strong>：既有实时反馈，又有高准确度</li><li>✅ <strong>最佳用户体验</strong>：先给用户看实时结果，再提供修正后的准确结果</li><li>❌ <strong>资源占用最高</strong>：需要同时维护实时处理和离线修正</li><li>❌ <strong>延迟稍高</strong>：最终结果需要等待离线修正完成</li></ul><p><strong>适用场景：</strong></p><ul><li>需要实时反馈且要求高准确度的场景</li><li>语音输入法（先显示实时结果，再修正）</li><li>会议实时转录（实时显示 + 会后修正）</li></ul><p><strong>返回值特点：</strong></p><ul><li>先返回 <code>mode: &quot;2pass-online&quot;</code>，<code>is_final: false</code>（实时结果）</li><li>最后返回 <code>mode: &quot;2pass-offline&quot;</code>，<code>is_final: true</code>（修正结果，更准确）</li></ul><p><strong>工作流程：</strong></p>',10)),(a(),l(p,null,{default:i(()=>[h(n,{id:"mermaid-322",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20Client%20as%20%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%20%20%20%20participant%20Server%20as%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%3Cbr%2F%3E(mode%3A%20%222pass%22%2C%20chunk_size)%0A%20%20%20%20%0A%20%20%20%20loop%20%E6%8C%81%E7%BB%AD%E5%8F%91%E9%80%81%E9%9F%B3%E9%A2%91%E6%B5%81%0A%20%20%20%20%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E9%9F%B3%E9%A2%91%E7%89%87%E6%AE%B5%3Cbr%2F%3E(%E4%BA%8C%E8%BF%9B%E5%88%B6%20chunk)%0A%20%20%20%20%20%20%20%20Note%20over%20Server%3A%20%E5%9C%A8%E7%BA%BF%E6%A8%A1%E5%9E%8B%E5%AE%9E%E6%97%B6%E8%AF%86%E5%88%AB%0A%20%20%20%20%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%E5%AE%9E%E6%97%B6%E7%BB%93%E6%9E%9C%3Cbr%2F%3E(mode%3A%20%222pass-online%22%2C%3Cbr%2F%3Eis_final%3A%20false)%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%E7%BB%93%E6%9D%9F%E6%A0%87%E5%BF%97%3Cbr%2F%3E(is_speaking%3A%20false)%0A%20%20%20%20Note%20over%20Server%3A%20%E7%A6%BB%E7%BA%BF%E6%A8%A1%E5%9E%8B%E4%BF%AE%E6%AD%A3%E8%AF%86%E5%88%AB%0A%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%E4%BF%AE%E6%AD%A3%E7%BB%93%E6%9E%9C%3Cbr%2F%3E(mode%3A%20%222pass-offline%22%2C%3Cbr%2F%3Eis_final%3A%20true%2C%20%E6%9B%B4%E5%87%86%E7%A1%AE)%0A"})]),fallback:i(()=>[...s[2]||(s[2]=[e(" Loading... ",-1)])]),_:1})),s[9]||(s[9]=t(`<h3 id="_2-4-模式对比总结" tabindex="-1">2.4 模式对比总结 <a class="header-anchor" href="#_2-4-模式对比总结" aria-label="Permalink to &quot;2.4 模式对比总结&quot;">​</a></h3><table tabindex="0"><thead><tr><th>模式</th><th>实时性</th><th>准确度</th><th>资源占用</th><th>返回次数</th><th>适用场景</th></tr></thead><tbody><tr><td><code>offline</code></td><td>❌ 无</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>1 次</td><td>录音后识别、文件转写</td></tr><tr><td><code>online</code></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>多次</td><td>实时语音输入</td></tr><tr><td><code>2pass</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>多次</td><td>需要实时+高准确度</td></tr></tbody></table><p><strong>选择建议：</strong></p><ul><li>如果只需要录音后识别 → 选择 <code>offline</code>（最简单、最省资源）</li><li>如果需要实时反馈 → 选择 <code>online</code> 或 <code>2pass</code></li><li>如果既要实时又要准确 → 选择 <code>2pass</code>（但资源占用最高）</li></ul><h2 id="三、部署方式说明" tabindex="-1">三、部署方式说明 <a class="header-anchor" href="#三、部署方式说明" aria-label="Permalink to &quot;三、部署方式说明&quot;">​</a></h2><p>FunASR 提供了两种部署方式，<strong>本质区别在于实现语言和部署方式，而非端口号</strong>。端口号只是官方约定的默认值，都可以通过参数修改。</p><h3 id="_3-1-sdk-部署-c-实现-概述" tabindex="-1">3.1 SDK 部署（C++ 实现）概述 <a class="header-anchor" href="#_3-1-sdk-部署-c-实现-概述" aria-label="Permalink to &quot;3.1 SDK 部署（C++ 实现）概述&quot;">​</a></h3><p><strong>部署方式：</strong></p><ul><li>使用 FunASR SDK（C++ 实现）</li><li>通过 Docker 镜像 <code>funasr-runtime-sdk-cpu-*</code> 部署</li><li><strong>默认端口：10095</strong>（可通过 <code>--port</code> 参数修改）</li></ul><p><strong>特点：</strong></p><ul><li>✅ <strong>性能高</strong>：C++ 实现，性能最优</li><li>✅ <strong>资源占用低</strong>：适合生产环境</li><li>✅ <strong>稳定性好</strong>：经过大量生产验证</li><li>✅ <strong>高并发</strong>：支持上百路并发请求</li><li>❌ <strong>配置相对复杂</strong>：需要了解启动参数</li><li>❌ <strong>需要 Docker</strong>：必须使用 Docker 环境</li></ul><p><strong>Docker 镜像类型：</strong></p><p>FunASR 提供了多种 Docker 镜像，<strong>不同的 SDK 文档对应不同的镜像源</strong>。镜像类型主要根据<strong>硬件环境</strong>进行区分。</p><p><strong>实际使用的镜像示例：</strong></p><ul><li>CPU 版本：<code>funasr-runtime-sdk-cpu-0.4.7</code>（本文档示例）</li><li>GPU/CUDA 版本：具体镜像名称请参考官方 GPU 部署文档</li></ul><p><strong>为什么有多个不同的镜像？</strong></p><ol><li><p><strong>硬件环境差异（主要区别）</strong>：</p><ul><li><strong>CPU 版本</strong>：适用于没有 GPU 的服务器，使用 CPU 进行推理，只需要基础的运行库</li><li><strong>GPU/CUDA 版本</strong>：适用于有 NVIDIA GPU 的环境，利用 GPU 加速，需要 CUDA、cuDNN 等 GPU 相关库，性能提升显著</li></ul></li><li><p><strong>镜像本身是通用的</strong>：</p><ul><li><strong>重要理解</strong>：同一个镜像（如 <code>funasr-runtime-sdk-cpu-0.4.7</code>）包含了所有依赖（离线和在线模型的依赖都有）</li><li><strong>模式支持由启动脚本决定</strong>：使用 <code>run_server.sh</code> 只支持 offline，使用 <code>run_server_2pass.sh</code> 支持所有模式</li><li><strong>示例</strong>：即使使用 &quot;offline&quot; 镜像，通过 <code>run_server_2pass.sh</code> 启动并配置在线模型后，也可以运行 online 和 2pass 模式</li></ul></li><li><p><strong>不同 SDK 文档对应不同镜像</strong>：</p><ul><li>官方文档中，不同的 SDK 部署文档会指定对应的镜像源</li><li><strong>主要区别是 CPU vs GPU</strong>：CPU 部署文档使用 CPU 版本镜像，GPU 部署文档使用 GPU/CUDA 版本镜像</li><li><strong>识别模式的区别不在镜像，而在启动脚本</strong>：同一个镜像可以通过不同的启动脚本支持不同的模式</li></ul></li></ol><p><strong>如何选择合适的镜像？</strong></p><p><strong>根据硬件环境选择</strong>：</p><ul><li><strong>无 GPU 环境</strong> → 选择 CPU 版本（如 <code>funasr-runtime-sdk-cpu-*</code>）</li><li><strong>有 GPU 环境</strong> → 选择 GPU/CUDA 版本（如 <code>funasr-runtime-sdk-cuda-*</code>，性能更高）</li></ul><p><strong>模式支持由启动脚本决定</strong>：</p><ul><li><strong>只需要 offline 模式</strong> → 使用 <code>run_server.sh</code> 启动（资源占用更低）</li><li><strong>需要 online/2pass 模式</strong> → 使用 <code>run_server_2pass.sh</code> 启动（需要配置在线模型）</li></ul><blockquote><p><strong>⚠️ 重要说明</strong>：</p><ul><li><strong>镜像本身是通用的</strong>：同一个镜像包含了所有依赖，可以通过不同的启动脚本支持不同的模式</li><li><strong>模式支持由启动脚本决定</strong>：<code>run_server.sh</code> 只支持 offline，<code>run_server_2pass.sh</code> 支持所有模式</li><li><strong>具体镜像名称请参考官方文档</strong>：不同版本的 FunASR 和不同的部署场景，镜像名称可能不同</li><li><strong>请查阅 <a href="https://github.com/modelscope/FunASR/tree/main/runtime/docs" target="_blank" rel="noreferrer">FunASR 官方文档</a></strong> 中对应的 SDK 部署文档，确认具体的镜像名称和下载地址</li><li><strong>本文档示例使用</strong>：<code>funasr-runtime-sdk-cpu-0.4.7</code>（CPU 版本），其他版本请参考官方文档</li></ul></blockquote><p><strong>两种启动方式：</strong> FunASR SDK 部署提供了两种启动脚本，<strong>模式支持能力不同</strong>：</p><ul><li><strong><code>run_server.sh</code></strong>：仅支持 <code>offline</code> 模式，适合只需要录音后识别的场景</li><li><strong><code>run_server_2pass.sh</code></strong>：支持所有模式（offline、online、2pass），客户端可动态切换，最灵活</li></ul><blockquote><p><strong>注意</strong>：启动脚本的选择决定了服务端支持哪些识别模式。详细说明见 3.2 节。</p></blockquote><h3 id="_3-2-sdk-部署的两种启动方式" tabindex="-1">3.2 SDK 部署的两种启动方式 <a class="header-anchor" href="#_3-2-sdk-部署的两种启动方式" aria-label="Permalink to &quot;3.2 SDK 部署的两种启动方式&quot;">​</a></h3><p><strong>⚠️ 重要区别：启动脚本决定模式支持能力</strong></p><p>对于 <strong>SDK 部署（10095）</strong>，FunASR 提供了两种启动脚本，<strong>模式支持能力不同</strong>。选择哪个启动脚本，决定了服务端能够支持哪些识别模式。</p><h4 id="_3-2-1-run-server-sh-仅支持-offline-模式" tabindex="-1">3.2.1 run_server.sh（仅支持 offline 模式） <a class="header-anchor" href="#_3-2-1-run-server-sh-仅支持-offline-模式" aria-label="Permalink to &quot;3.2.1 run_server.sh（仅支持 offline 模式）&quot;">​</a></h4><p><strong>启动脚本：</strong> <code>run_server.sh</code><br><strong>可执行文件：</strong> <code>funasr-wss-server</code><br><strong>支持模式：</strong> ❌ 仅支持 <code>offline</code> 模式</p><p><strong>特点：</strong></p><ul><li>只加载离线模型（<code>--model-dir</code>）</li><li>无论客户端发送什么 <code>mode</code> 参数，都按 offline 模式处理</li><li>返回格式固定为 offline 格式（包含 <code>stamp_sents</code> 等）</li><li>适合只需要录音后识别的场景</li><li>资源占用相对较少</li></ul><p><strong>适用场景：</strong></p><ul><li>录音后识别（微信式录音）</li><li>文件转写（mp3、mp4 等音频文件）</li><li>批量音频处理</li><li>只需要 offline 模式的场景</li></ul><p><strong>启动命令示例：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FunASR/runtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --download-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --vad-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_fsmn_vad_zh-cn-16k-common-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large-vad-punc_asr_nat-zh-cn-16k-common-vocab8404-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --punc-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/punc_ct-transformer_cn-en-common-vocab471067-large-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --lm-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_ngram_lm_zh-cn-ai-wesp-fst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --itn-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thuduj12/fst_itn_zh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --certfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><p><strong>必需模型：</strong></p><ul><li><code>--vad-dir</code>：VAD 模型（必需）</li><li><code>--model-dir</code>：ASR 离线模型（必需）</li><li><code>--punc-dir</code>：标点模型（必需）</li></ul><p><strong>可选模型：</strong></p><ul><li><code>--lm-dir</code>：语言模型（可选，提升准确度）</li><li><code>--itn-dir</code>：ITN 模型（可选，提升准确度）</li></ul><h4 id="_3-2-2-run-server-2pass-sh-支持所有模式" tabindex="-1">3.2.2 run_server_2pass.sh（支持所有模式） <a class="header-anchor" href="#_3-2-2-run-server-2pass-sh-支持所有模式" aria-label="Permalink to &quot;3.2.2 run_server_2pass.sh（支持所有模式）&quot;">​</a></h4><p><strong>启动脚本：</strong> <code>run_server_2pass.sh</code><br><strong>可执行文件：</strong> <code>funasr-wss-server-2pass</code><br><strong>支持模式：</strong> ✅ 支持 <code>offline</code>、<code>online</code>、<code>2pass</code> 三种模式</p><p><strong>特点：</strong></p><ul><li>同时加载离线模型（<code>--model-dir</code>）和在线模型（<code>--online-model-dir</code>）</li><li>使用实时标点模型（<code>punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727-onnx</code>）</li><li>客户端可以通过 <code>mode</code> 参数动态切换模式</li><li>适合需要多种模式的场景</li><li>资源占用相对较高（需要加载更多模型）</li></ul><p><strong>适用场景：</strong></p><ul><li>需要支持多种识别模式的场景</li><li>需要实时语音识别（online 模式）</li><li>需要兼顾实时性和准确度（2pass 模式）</li><li>生产环境推荐（功能最全面）</li></ul><p><strong>启动命令示例：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FunASR/runtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server_2pass.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --download-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --vad-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_fsmn_vad_zh-cn-16k-common-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large-vad-punc_asr_nat-zh-cn-16k-common-vocab8404-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --online-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large_asr_nat-zh-cn-16k-common-vocab8404-online-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --punc-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --lm-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_ngram_lm_zh-cn-ai-wesp-fst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --itn-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thuduj12/fst_itn_zh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --certfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><p><strong>必需模型：</strong></p><ul><li><code>--vad-dir</code>：VAD 模型（必需）</li><li><code>--model-dir</code>：ASR 离线模型（必需）</li><li><code>--online-model-dir</code>：ASR 在线模型（必需，用于 online/2pass 模式）</li><li><code>--punc-dir</code>：实时标点模型（必需，使用实时标点模型）</li></ul><p><strong>可选模型：</strong></p><ul><li><code>--lm-dir</code>：语言模型（可选，提升准确度）</li><li><code>--itn-dir</code>：ITN 模型（可选，提升准确度）</li></ul><p><strong>关键区别：</strong></p><ul><li><code>run_server_2pass.sh</code> 需要额外的在线模型（<code>--online-model-dir</code>）</li><li>标点模型需要使用实时标点模型（<code>punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727-onnx</code>）</li></ul><h4 id="_3-2-3-两种启动脚本对比" tabindex="-1">3.2.3 两种启动脚本对比 <a class="header-anchor" href="#_3-2-3-两种启动脚本对比" aria-label="Permalink to &quot;3.2.3 两种启动脚本对比&quot;">​</a></h4><p><strong>功能对比：</strong></p><table tabindex="0"><thead><tr><th>维度</th><th>run_server.sh</th><th>run_server_2pass.sh</th></tr></thead><tbody><tr><td><strong>可执行文件</strong></td><td><code>funasr-wss-server</code></td><td><code>funasr-wss-server-2pass</code></td></tr><tr><td><strong>离线模型</strong></td><td>✅ <code>--model-dir</code></td><td>✅ <code>--model-dir</code></td></tr><tr><td><strong>在线模型</strong></td><td>❌ 无</td><td>✅ <code>--online-model-dir</code>（必需）</td></tr><tr><td><strong>标点模型</strong></td><td><code>punc_ct-transformer_cn-en-common-vocab471067-large-onnx</code></td><td><code>punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727-onnx</code></td></tr><tr><td><strong>支持 offline</strong></td><td>✅ 是</td><td>✅ 是</td></tr><tr><td><strong>支持 online</strong></td><td>❌ 否（强制按 offline 处理）</td><td>✅ 是</td></tr><tr><td><strong>支持 2pass</strong></td><td>❌ 否（强制按 offline 处理）</td><td>✅ 是</td></tr><tr><td><strong>客户端动态切换</strong></td><td>❌ 不支持</td><td>✅ 支持</td></tr><tr><td><strong>资源占用</strong></td><td>⭐⭐ 较低</td><td>⭐⭐⭐⭐ 较高</td></tr><tr><td><strong>适用场景</strong></td><td>仅需要 offline 模式</td><td>需要多种模式</td></tr></tbody></table><p><strong>模式选择机制：</strong></p>`,59)),(a(),l(p,null,{default:i(()=>[h(n,{id:"mermaid-1033",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20A%5B%E9%80%89%E6%8B%A9%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%5D%20--%3E%20B%7B%E4%BD%BF%E7%94%A8%E5%93%AA%E4%B8%AA%E8%84%9A%E6%9C%AC%3F%7D%0A%20%20%20%20%0A%20%20%20%20B%20--%3E%7Crun_server.sh%7C%20C%5Bfunasr-wss-server%5D%0A%20%20%20%20C%20--%3E%20D%5B%E5%8F%AA%E5%8A%A0%E8%BD%BD%E7%A6%BB%E7%BA%BF%E6%A8%A1%E5%9E%8B%5D%0A%20%20%20%20D%20--%3E%20E%5B%E4%BB%85%E6%94%AF%E6%8C%81%20offline%20%E6%A8%A1%E5%BC%8F%5D%0A%20%20%20%20E%20--%3E%20F%5B%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E9%80%81%E4%BB%BB%E4%BD%95%20mode%20%E9%83%BD%E6%8C%89%20offline%20%E5%A4%84%E7%90%86%5D%0A%20%20%20%20%0A%20%20%20%20B%20--%3E%7Crun_server_2pass.sh%7C%20G%5Bfunasr-wss-server-2pass%5D%0A%20%20%20%20G%20--%3E%20H%5B%E5%8A%A0%E8%BD%BD%E7%A6%BB%E7%BA%BF%20%2B%20%E5%9C%A8%E7%BA%BF%E6%A8%A1%E5%9E%8B%5D%0A%20%20%20%20H%20--%3E%20I%5B%E6%94%AF%E6%8C%81%E6%89%80%E6%9C%89%E6%A8%A1%E5%BC%8F%5D%0A%20%20%20%20I%20--%3E%20J%7B%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E9%80%81%20mode%7D%0A%20%20%20%20J%20--%3E%7Coffline%7C%20K%5B%E7%A6%BB%E7%BA%BF%E6%A8%A1%E5%BC%8F%E8%AF%86%E5%88%AB%5D%0A%20%20%20%20J%20--%3E%7Conline%7C%20L%5B%E5%9C%A8%E7%BA%BF%E6%A8%A1%E5%BC%8F%E8%AF%86%E5%88%AB%5D%0A%20%20%20%20J%20--%3E%7C2pass%7C%20M%5B%E4%B8%A4%E9%81%8D%E6%A8%A1%E5%BC%8F%E8%AF%86%E5%88%AB%5D%0A"})]),fallback:i(()=>[...s[3]||(s[3]=[e(" Loading... ",-1)])]),_:1})),s[10]||(s[10]=t(`<p><strong>关键要点：</strong></p><ul><li>⚠️ <strong>启动脚本决定模式支持</strong>：使用 <code>run_server.sh</code> 只支持 offline，使用 <code>run_server_2pass.sh</code> 支持所有模式</li><li>✅ <strong>模式选择在客户端</strong>：使用 <code>run_server_2pass.sh</code> 时，客户端通过 WebSocket 消息中的 <code>mode</code> 参数选择使用哪个模式</li><li>✅ <strong>必需模型</strong>：VAD、ASR、PUNC（所有模式都需要）</li><li>✅ <strong>2pass 模式额外需要</strong>：在线模型（<code>--online-model-dir</code>）和实时标点模型</li><li>✅ <strong>同一个服务端可以同时处理不同模式</strong>：使用 <code>run_server_2pass.sh</code> 时，不同的客户端连接可以使用不同的模式</li></ul><p><strong>选择建议：</strong></p><ul><li>如果只需要录音后识别 → 使用 <code>run_server.sh</code>（最简单、最省资源）</li><li>如果需要支持多种模式 → 使用 <code>run_server_2pass.sh</code>（功能最全面，生产环境推荐）</li></ul><blockquote><p><strong>注意</strong>：</p><ul><li>详细的客户端使用方式和 WebSocket 消息格式请参考第五章</li><li>具体的 Docker 部署实践请参考第四章</li></ul></blockquote><h3 id="_3-3-python-websocket-服务器部署" tabindex="-1">3.3 Python WebSocket 服务器部署 <a class="header-anchor" href="#_3-3-python-websocket-服务器部署" aria-label="Permalink to &quot;3.3 Python WebSocket 服务器部署&quot;">​</a></h3><p><strong>部署方式：</strong></p><ul><li>使用 Python WebSocket 服务器</li><li>通过 <code>websocket_server.py</code> 启动</li><li><strong>默认端口：10096</strong>（可通过 <code>--port</code> 参数修改）</li><li>适合快速测试和开发</li></ul><p><strong>特点：</strong></p><ul><li>✅ <strong>部署简单</strong>：Python 环境即可运行，无需 Docker</li><li>✅ <strong>易于调试</strong>：Python 代码，方便修改和调试</li><li>✅ <strong>快速原型</strong>：适合快速验证功能</li><li>❌ <strong>性能相对较低</strong>：Python 实现，性能不如 C++</li><li>❌ <strong>资源占用较高</strong>：不适合高并发生产环境</li><li>❌ <strong>并发能力有限</strong>：通常支持 20-50 路并发</li></ul><h4 id="模式支持方式" tabindex="-1">模式支持方式 <a class="header-anchor" href="#模式支持方式" aria-label="Permalink to &quot;模式支持方式&quot;">​</a></h4><p><strong>⚠️ 重要说明：Python 服务器的模式支持方式需要查阅官方文档确认</strong></p><p>Python WebSocket 服务器（10096）的模式支持方式（offline、online、2pass）的具体实现和行为，请参考官方文档：</p><ul><li><strong>官方文档</strong>：<a href="https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket" target="_blank" rel="noreferrer">https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket</a></li><li><strong>建议</strong>：使用前请查阅官方文档，确认模式支持的具体实现方式</li></ul><blockquote><p><strong>注意</strong>：</p><ul><li>本文档主要介绍 SDK 部署方式（10095），这是生产环境推荐的方式</li><li>SDK 部署的模式支持行为已在官方文档中明确说明（详见 3.2 节）</li><li>Python 服务器的模式支持方式请参考官方 Python 部署文档</li></ul></blockquote><h4 id="启动命令和模型配置" tabindex="-1">启动命令和模型配置 <a class="header-anchor" href="#启动命令和模型配置" aria-label="Permalink to &quot;启动命令和模型配置&quot;">​</a></h4><p><strong>启动命令示例：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funasr.runtime.python.websocket.websocket_server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large-vad-punc_asr_nat-zh-cn-16k-common-vocab8404-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --vad_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_fsmn_vad_zh-cn-16k-common-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --punc_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/punc_ct-transformer_cn-en-common-vocab471067-large-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --lm_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_ngram_lm_zh-cn-ai-wesp-fst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --itn_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thuduj12/fst_itn_zh</span></span></code></pre></div><p><strong>必需模型参数：</strong></p><ul><li><code>--model_dir</code>：ASR 模型（必需）</li><li><code>--vad_dir</code>：VAD 模型（必需）</li><li><code>--punc_dir</code>：标点模型（必需）</li></ul><p><strong>可选模型参数：</strong></p><ul><li><code>--lm_dir</code>：语言模型（可选，提升准确度）</li><li><code>--itn_dir</code>：ITN 模型（可选，提升准确度）</li></ul><p><strong>参数说明：</strong></p><ul><li>参数命名与 SDK 部署略有不同（使用下划线 <code>_</code> 而非连字符 <code>-</code>）</li><li>模型 ID 和功能与 SDK 部署相同</li><li>模式支持方式请参考官方文档：<a href="https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket" target="_blank" rel="noreferrer">https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket</a></li></ul><blockquote><p><strong>注意</strong>：</p><ul><li>以上启动命令和参数基于官方文档，具体模式支持行为请查阅官方文档确认</li><li>如需精确控制识别模式，建议使用 SDK 部署（10095），其模式支持行为已在官方文档中明确说明</li></ul></blockquote><h3 id="_3-4-部署方式对比总结" tabindex="-1">3.4 部署方式对比总结 <a class="header-anchor" href="#_3-4-部署方式对比总结" aria-label="Permalink to &quot;3.4 部署方式对比总结&quot;">​</a></h3><table tabindex="0"><thead><tr><th>维度</th><th>SDK 部署（C++）</th><th>Python 服务器部署</th></tr></thead><tbody><tr><td><strong>实现语言</strong></td><td>C++</td><td>Python</td></tr><tr><td><strong>默认端口</strong></td><td>10095</td><td>10096</td></tr><tr><td><strong>端口可修改</strong></td><td>✅ 是</td><td>✅ 是</td></tr><tr><td><strong>性能</strong></td><td>⭐⭐⭐⭐⭐ 高</td><td>⭐⭐⭐ 中等</td></tr><tr><td><strong>资源占用</strong></td><td>⭐⭐ 低</td><td>⭐⭐⭐⭐ 较高</td></tr><tr><td><strong>并发能力</strong></td><td>100+ 路</td><td>20-50 路</td></tr><tr><td><strong>部署复杂度</strong></td><td>⭐⭐⭐ 中等</td><td>⭐⭐ 简单</td></tr><tr><td><strong>调试难度</strong></td><td>⭐⭐⭐ 较难</td><td>⭐⭐ 容易</td></tr><tr><td><strong>生产环境</strong></td><td>✅ 推荐</td><td>⚠️ 不推荐</td></tr></tbody></table><p><strong>重要理解：</strong></p><ul><li><strong>端口号只是默认值</strong>：10095 和 10096 只是官方约定的默认端口，都可以通过 <code>--port</code> 参数修改</li><li><strong>真正区别是部署方式</strong>：SDK（C++）vs Python 服务器</li><li><strong>模式支持差异</strong>： <ul><li><strong>SDK 部署（10095）</strong>：根据启动脚本不同，支持不同的模式（详见 3.2 节） <ul><li>使用 <code>run_server.sh</code>：仅支持 offline 模式</li><li>使用 <code>run_server_2pass.sh</code>：支持所有模式（offline、online、2pass），客户端通过 <code>mode</code> 参数选择</li></ul></li><li><strong>Python 服务器（10096）</strong>：模式支持方式请参考官方文档：<a href="https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket" target="_blank" rel="noreferrer">https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket</a></li></ul></li><li><strong>协议相同</strong>：都使用相同的 WebSocket 通信协议</li></ul><h3 id="_3-5-如何选择部署方式" tabindex="-1">3.5 如何选择部署方式 <a class="header-anchor" href="#_3-5-如何选择部署方式" aria-label="Permalink to &quot;3.5 如何选择部署方式&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>推荐部署方式</th><th>原因</th></tr></thead><tbody><tr><td>生产环境</td><td>SDK 部署</td><td>性能高、资源占用低、稳定性好、高并发</td></tr><tr><td>开发测试</td><td>Python 服务器</td><td>部署简单、易于调试、无需 Docker</td></tr><tr><td>高并发场景</td><td>SDK 部署</td><td>C++ 实现，性能最优</td></tr><tr><td>快速原型</td><td>Python 服务器</td><td>无需 Docker，直接运行</td></tr><tr><td>资源受限</td><td>SDK 部署</td><td>内存和 CPU 占用更低</td></tr></tbody></table><p><strong>注意：</strong></p><ul><li>本文档主要介绍 SDK 部署方式，这是生产环境推荐的方式</li><li><strong>SDK 部署（10095）</strong>：根据启动脚本不同，支持不同的模式（详见 3.2 节）</li><li><strong>Python 服务器（10096）</strong>：模式支持方式请参考官方文档：<a href="https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket" target="_blank" rel="noreferrer">https://github.com/modelscope/FunASR/tree/main/runtime/python/websocket</a></li></ul><h3 id="_3-6-模式支持方式快速参考" tabindex="-1">3.6 模式支持方式快速参考 <a class="header-anchor" href="#_3-6-模式支持方式快速参考" aria-label="Permalink to &quot;3.6 模式支持方式快速参考&quot;">​</a></h3><blockquote><p><strong>说明</strong>：本节提供模式支持方式的快速参考表。详细的启动脚本说明和选择建议请参考 3.2 节。</p></blockquote><p><strong>SDK 部署（10095）vs Python 服务器（10096）的模式支持方式：</strong></p><table tabindex="0"><thead><tr><th>部署方式</th><th>启动脚本</th><th>模式支持方式</th><th>必需模型</th></tr></thead><tbody><tr><td><strong>SDK 部署（10095）</strong></td><td><code>run_server.sh</code></td><td>❌ <strong>仅支持 offline 模式</strong></td><td>VAD + ASR + PUNC（必需）<br>LM + ITN（可选）</td></tr><tr><td><strong>SDK 部署（10095）</strong></td><td><code>run_server_2pass.sh</code></td><td>✅ <strong>支持所有模式</strong>（offline、online、2pass）</td><td>VAD + ASR + PUNC + <strong>在线模型</strong>（必需）<br>LM + ITN（可选）</td></tr><tr><td><strong>Python 服务器（10096）</strong></td><td><code>websocket_server.py</code></td><td>⚠️ <strong>请参考官方文档</strong></td><td>VAD + ASR + PUNC（必需）<br>LM + ITN（可选）</td></tr></tbody></table><p><strong>重要区别：</strong></p><ul><li><strong>SDK 部署 - run_server.sh</strong>：只支持 offline 模式，适合只需要录音后识别的场景（详见 3.2.1 节）</li><li><strong>SDK 部署 - run_server_2pass.sh</strong>：支持所有模式，客户端可动态切换，最灵活，生产环境推荐（详见 3.2.2 节）</li><li><strong>Python 服务器</strong>：模式支持方式请参考官方文档确认</li></ul><p><strong>模型配置对比：</strong></p><table tabindex="0"><thead><tr><th>模型类型</th><th>SDK 部署参数</th><th>Python 服务器参数</th><th>run_server.sh</th><th>run_server_2pass.sh</th></tr></thead><tbody><tr><td>VAD 模型</td><td><code>--vad-dir</code></td><td><code>--vad_dir</code></td><td>✅ 必需</td><td>✅ 必需</td></tr><tr><td>ASR 离线模型</td><td><code>--model-dir</code></td><td><code>--model_dir</code></td><td>✅ 必需</td><td>✅ 必需</td></tr><tr><td>ASR 在线模型</td><td><code>--online-model-dir</code></td><td><code>--online_model_dir</code></td><td>❌ 不需要</td><td>✅ 必需（用于 online/2pass）</td></tr><tr><td>标点模型</td><td><code>--punc-dir</code></td><td><code>--punc_dir</code></td><td>✅ 必需</td><td>✅ 必需（使用实时标点模型）</td></tr><tr><td>语言模型</td><td><code>--lm-dir</code></td><td><code>--lm_dir</code></td><td>⚠️ 可选</td><td>⚠️ 可选</td></tr><tr><td>ITN 模型</td><td><code>--itn-dir</code></td><td><code>--itn_dir</code></td><td>⚠️ 可选</td><td>⚠️ 可选</td></tr></tbody></table><p><strong>注意：</strong></p><ul><li>Python 服务器的参数使用下划线（<code>_</code>），SDK 部署使用连字符（<code>-</code>），但模型 ID 和功能相同</li><li><code>run_server_2pass.sh</code> 需要额外的在线模型（<code>--online-model-dir</code>）和实时标点模型</li><li><code>run_server.sh</code> 只使用离线模型和普通标点模型</li><li>详细的启动脚本说明、启动命令和选择建议请参考 3.2 节</li></ul><h2 id="四、sdk-部署实践-docker" tabindex="-1">四、SDK 部署实践（Docker） <a class="header-anchor" href="#四、sdk-部署实践-docker" aria-label="Permalink to &quot;四、SDK 部署实践（Docker）&quot;">​</a></h2><blockquote><p><strong>说明</strong>：本章节详细介绍 SDK 部署方式（Docker + C++ 实现），这是生产环境推荐的方式。Python 服务器部署方式请参考官方文档。</p></blockquote><h3 id="_4-1-拉取镜像" tabindex="-1">4.1 拉取镜像 <a class="header-anchor" href="#_4-1-拉取镜像" aria-label="Permalink to &quot;4.1 拉取镜像&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  registry.cn-hangzhou.aliyuncs.com/funasr_repo/funasr:funasr-runtime-sdk-cpu-0.4.7</span></span></code></pre></div><h3 id="_4-2-启动容器" tabindex="-1">4.2 启动容器 <a class="header-anchor" href="#_4-2-启动容器" aria-label="Permalink to &quot;4.2 启动容器&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建模型目录（用于挂载）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./funasr-runtime-resources/models</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10095:10095</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --privileged=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $PWD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/funasr-runtime-resources/models:/workspace/models</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  registry.cn-hangzhou.aliyuncs.com/funasr_repo/funasr:funasr-runtime-sdk-cpu-0.4.7</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>-p 10095:10095</code>：映射容器端口到主机端口（FunASR 默认端口为 10095）</li><li><code>--privileged=true</code>：赋予容器特权模式（某些功能需要）</li><li><code>-v $PWD/funasr-runtime-resources/models:/workspace/models</code>：挂载模型目录，模型会自动下载到此目录</li></ul><h3 id="_4-3-启动服务" tabindex="-1">4.3 启动服务 <a class="header-anchor" href="#_4-3-启动服务" aria-label="Permalink to &quot;4.3 启动服务&quot;">​</a></h3><p>进入容器后，根据需求选择启动脚本：</p><h4 id="_4-3-1-仅支持-offline-模式-推荐用于录音后识别" tabindex="-1">4.3.1 仅支持 offline 模式（推荐用于录音后识别） <a class="header-anchor" href="#_4-3-1-仅支持-offline-模式-推荐用于录音后识别" aria-label="Permalink to &quot;4.3.1 仅支持 offline 模式（推荐用于录音后识别）&quot;">​</a></h4><p>如果只需要录音后识别功能，使用 <code>run_server.sh</code>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FunASR/runtime</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动服务（16k 模型，关闭 SSL，仅支持 offline 模式）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --download-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --vad-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_fsmn_vad_zh-cn-16k-common-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large-vad-punc_asr_nat-zh-cn-16k-common-vocab8404-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --punc-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/punc_ct-transformer_cn-en-common-vocab471067-large-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --lm-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_ngram_lm_zh-cn-ai-wesp-fst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --itn-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thuduj12/fst_itn_zh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --certfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log.txt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log.txt</span></span></code></pre></div><blockquote><p><strong>说明</strong>：使用 <code>run_server.sh</code> 启动的服务只支持 <code>offline</code> 模式。无论客户端发送什么 <code>mode</code> 参数，都会按 offline 模式处理。适合只需要录音后识别的场景。</p></blockquote><h4 id="_4-3-2-支持所有模式-推荐用于需要多种模式的场景" tabindex="-1">4.3.2 支持所有模式（推荐用于需要多种模式的场景） <a class="header-anchor" href="#_4-3-2-支持所有模式-推荐用于需要多种模式的场景" aria-label="Permalink to &quot;4.3.2 支持所有模式（推荐用于需要多种模式的场景）&quot;">​</a></h4><p>如果需要支持 <code>offline</code>、<code>online</code>、<code>2pass</code> 三种模式，使用 <code>run_server_2pass.sh</code>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FunASR/runtime</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动服务（16k 模型，关闭 SSL，支持所有模式）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server_2pass.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --download-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --vad-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_fsmn_vad_zh-cn-16k-common-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large-vad-punc_asr_nat-zh-cn-16k-common-vocab8404-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --online-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer-large_asr_nat-zh-cn-16k-common-vocab8404-online-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --punc-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --lm-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_ngram_lm_zh-cn-ai-wesp-fst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --itn-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thuduj12/fst_itn_zh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --certfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log_2pass.txt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log_2pass.txt</span></span></code></pre></div><blockquote><p><strong>说明</strong>：使用 <code>run_server_2pass.sh</code> 启动的服务支持所有模式（offline、online、2pass）。客户端可以通过 <code>mode</code> 参数动态切换模式。首次启动会下载在线模型，可能需要几分钟时间。详见 3.2 节和 5.5 节。</p></blockquote><p><strong>启动参数说明：</strong></p><table tabindex="0"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>--download-model-dir</code></td><td>模型下载地址，通过设置 model ID 从 Modelscope 下载模型</td></tr><tr><td><code>--model-dir</code></td><td>ASR 模型 ID 或本地模型路径</td></tr><tr><td><code>--vad-dir</code></td><td>VAD 模型 ID 或本地模型路径</td></tr><tr><td><code>--punc-dir</code></td><td>标点模型 ID 或本地模型路径</td></tr><tr><td><code>--lm-dir</code></td><td>语言模型 ID 或本地模型路径</td></tr><tr><td><code>--itn-dir</code></td><td>ITN 模型 ID 或本地模型路径</td></tr><tr><td><code>--port</code></td><td>服务端监听端口号，默认为 10095</td></tr><tr><td><code>--certfile</code></td><td>SSL 证书文件，设置为 <code>0</code> 表示关闭 SSL</td></tr><tr><td><code>--keyfile</code></td><td>SSL 密钥文件</td></tr><tr><td><code>--hotword</code></td><td>热词文件路径（可选）</td></tr><tr><td><code>--decoder-thread-num</code></td><td>服务端线程池个数（支持的最大并发路数）</td></tr><tr><td><code>--io-thread-num</code></td><td>服务端启动的 IO 线程数</td></tr><tr><td><code>--model-thread-num</code></td><td>每路识别的内部线程数，默认为 1</td></tr></tbody></table><p><strong>8k 模型启动示例：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FunASR/runtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --download-model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --vad-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_fsmn_vad_zh-cn-8k-common-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_paraformer_asr_nat-zh-cn-8k-common-vocab8358-tensorflow1-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --punc-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/punc_ct-transformer_cn-en-common-vocab471067-large-onnx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --lm-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> damo/speech_ngram_lm_zh-cn-ai-wesp-fst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --itn-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thuduj12/fst_itn_zh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --certfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log.txt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span></code></pre></div><h3 id="_4-4-验证服务" tabindex="-1">4.4 验证服务 <a class="header-anchor" href="#_4-4-验证服务" aria-label="Permalink to &quot;4.4 验证服务&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看服务进程</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funasr-wss-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看端口监听</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log.txt</span></span></code></pre></div><p>服务启动成功后，日志中应该看到：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[INFO] FunASR WebSocket server started on port 10095</span></span>
<span class="line"><span>[INFO] Model loaded successfully</span></span></code></pre></div><h3 id="_4-5-关闭服务" tabindex="-1">4.5 关闭服务 <a class="header-anchor" href="#_4-5-关闭服务" aria-label="Permalink to &quot;4.5 关闭服务&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 funasr-wss-server 对应的 PID</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> funasr-wss-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 关闭服务</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PID</span></span></code></pre></div><h2 id="五、websocket-通信协议" tabindex="-1">五、WebSocket 通信协议 <a class="header-anchor" href="#五、websocket-通信协议" aria-label="Permalink to &quot;五、WebSocket 通信协议&quot;">​</a></h2><p>FunASR 基于 WebSocket 协议进行通信，采用<strong>混合消息格式</strong>：配置信息用 JSON，音频数据用二进制。</p><h3 id="_5-1-消息格式" tabindex="-1">5.1 消息格式 <a class="header-anchor" href="#_5-1-消息格式" aria-label="Permalink to &quot;5.1 消息格式&quot;">​</a></h3><p>FunASR 的 WebSocket 通信采用两种消息类型：</p><ol><li><strong>JSON 消息</strong>：用于发送配置参数和元数据</li><li><strong>二进制消息</strong>：用于发送音频数据（PCM 格式为 Int16Array）</li></ol>`,76)),(a(),l(p,null,{default:i(()=>[h(n,{id:"mermaid-2017",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%E5%AE%A2%E6%88%B7%E7%AB%AF%5D%20--%3E%7CJSON%20%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%7C%20B%5BWebSocket%20%E8%BF%9E%E6%8E%A5%5D%0A%20%20%20%20A%20--%3E%7C%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%9F%B3%E9%A2%91%E6%95%B0%E6%8D%AE%7C%20B%0A%20%20%20%20B%20--%3E%7CJSON%20%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C%7C%20C%5B%E6%9C%8D%E5%8A%A1%E7%AB%AF%5D%0A%20%20%20%20B%20--%3E%7C%E5%A4%84%E7%90%86%E9%9F%B3%E9%A2%91%7C%20C%0A%20%20%20%20C%20--%3E%7CJSON%20%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C%7C%20B%0A%20%20%20%20B%20--%3E%7C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%7C%20A%0A"})]),fallback:i(()=>[...s[4]||(s[4]=[e(" Loading... ",-1)])]),_:1})),s[11]||(s[11]=t(`<p>这种设计的好处是：</p><ul><li>JSON 消息便于解析和调试</li><li>二进制消息传输音频数据效率高</li><li>两种消息类型可以混合发送</li></ul><h3 id="_5-2-离线文件转写模式-offline" tabindex="-1">5.2 离线文件转写模式（offline） <a class="header-anchor" href="#_5-2-离线文件转写模式-offline" aria-label="Permalink to &quot;5.2 离线文件转写模式（offline）&quot;">​</a></h3><h4 id="客户端-→-服务端" tabindex="-1">客户端 → 服务端 <a class="header-anchor" href="#客户端-→-服务端" aria-label="Permalink to &quot;客户端 → 服务端&quot;">​</a></h4><p><strong>首次通信（配置消息）：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;hotwords&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">阿里巴巴</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:20,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">通义实验室</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:30}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;itn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;audio_fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>参数说明：</strong></p><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>mode</code></td><td>string</td><td>固定为 <code>&quot;offline&quot;</code>，表示推理模式为离线文件转写</td></tr><tr><td><code>wav_name</code></td><td>string</td><td>需要推理的音频文件名</td></tr><tr><td><code>wav_format</code></td><td>string</td><td>音视频文件后缀名，可选 <code>pcm</code>、<code>mp3</code>、<code>mp4</code> 等。<strong>注意</strong>：当输入音频为 PCM 数据时，必须指定 <code>wav_format: &quot;pcm&quot;</code> 和 <code>audio_fs</code></td></tr><tr><td><code>is_speaking</code></td><td>boolean</td><td><code>true</code> 表示开始识别，<code>false</code> 表示断句尾点或音频结束</td></tr><tr><td><code>audio_fs</code></td><td>number</td><td>当输入音频为 pcm 数据时，<strong>必需</strong>指定音频采样率（如 16000、8000）。与 <code>wav_format: &quot;pcm&quot;</code> 配合使用</td></tr><tr><td><code>hotwords</code></td><td>string</td><td>热词数据（JSON 字符串格式），例如 <code>&quot;{\\&quot;阿里巴巴\\&quot;:20,\\&quot;通义实验室\\&quot;:30}&quot;</code>，数字为权重</td></tr><tr><td><code>itn</code></td><td>boolean</td><td>设置是否使用 ITN（逆文本规范化），默认为 <code>true</code></td></tr><tr><td><code>svs_lang</code></td><td>string</td><td>设置 SenseVoiceSmall 模型语种，默认为 <code>&quot;auto&quot;</code></td></tr><tr><td><code>svs_itn</code></td><td>boolean</td><td>设置 SenseVoiceSmall 模型是否开启标点、ITN，默认为 <code>true</code></td></tr></tbody></table><p><strong>发送音频数据：</strong></p><ul><li><strong>PCM 格式</strong>：直接将音频数据（Int16Array）以二进制形式发送</li><li><strong>其他格式</strong>：连同头部信息与音视频 bytes 数据一起发送</li></ul><p><strong>发送结束标志：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="服务端-→-客户端" tabindex="-1">服务端 → 客户端 <a class="header-anchor" href="#服务端-→-客户端" aria-label="Permalink to &quot;服务端 → 客户端&quot;">​</a></h4><p><strong>识别结果消息：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;asr outputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[[100,200], [200,500]]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;stamp_sents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>参数说明：</strong></p><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>mode</code></td><td>string</td><td>固定为 <code>&quot;offline&quot;</code>，表示推理模式为离线文件转写</td></tr><tr><td><code>wav_name</code></td><td>string</td><td>推理的音频文件名</td></tr><tr><td><code>text</code></td><td>string</td><td>语音识别输出文本</td></tr><tr><td><code>is_final</code></td><td>boolean</td><td>在 offline 模式下，服务端只会返回一次识别结果，此字段为 <code>False</code>（虽然为 False，但这是唯一一次返回，实际上就是最终结果）</td></tr><tr><td><code>timestamp</code></td><td>string</td><td>如果 AM 为时间戳模型，会返回此字段，表示字级别时间戳，格式为 <code>&quot;[[100,200], [200,500]]&quot;</code>（单位：毫秒）</td></tr><tr><td><code>stamp_sents</code></td><td>array</td><td>如果 AM 为时间戳模型，会返回此字段，表示句子级别时间戳</td></tr></tbody></table><p><strong><code>stamp_sents</code> 格式示例：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;text_seg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;正 是 因 为&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;punc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">430</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1130</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;ts_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">430</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">670</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">670</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">810</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">810</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1030</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1030</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1130</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h3 id="_5-3-实时语音识别模式-online-2pass" tabindex="-1">5.3 实时语音识别模式（online / 2pass） <a class="header-anchor" href="#_5-3-实时语音识别模式-online-2pass" aria-label="Permalink to &quot;5.3 实时语音识别模式（online / 2pass）&quot;">​</a></h3><h4 id="客户端-→-服务端-1" tabindex="-1">客户端 → 服务端 <a class="header-anchor" href="#客户端-→-服务端-1" aria-label="Permalink to &quot;客户端 → 服务端&quot;">​</a></h4><p><strong>首次通信（配置消息）：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2pass&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;chunk_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;hotwords&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">阿里巴巴</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:20,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">通义实验室</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:30}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;itn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;audio_fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>参数说明：</strong></p><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>mode</code></td><td>string</td><td><code>&quot;offline&quot;</code> 表示一句话识别；<code>&quot;online&quot;</code> 表示实时语音识别；<code>&quot;2pass&quot;</code> 表示实时语音识别，并且说话句尾采用离线模型进行纠错</td></tr><tr><td><code>wav_name</code></td><td>string</td><td>需要推理的音频文件名</td></tr><tr><td><code>wav_format</code></td><td>string</td><td>音视频文件后缀名，只支持 <code>pcm</code> 音频流</td></tr><tr><td><code>is_speaking</code></td><td>boolean</td><td><code>true</code> 表示开始识别，<code>false</code> 表示断句尾点或音频结束</td></tr><tr><td><code>chunk_size</code></td><td>array</td><td>流式模型 latency 配置，<code>[5,10,5]</code> 表示当前音频为 600ms，并且回看 300ms，又看 300ms</td></tr><tr><td><code>audio_fs</code></td><td>number</td><td>当输入音频为 pcm 数据时，需要指定音频采样率（支持 8000、16000）</td></tr><tr><td><code>hotwords</code></td><td>string</td><td>热词数据（JSON 字符串格式）</td></tr><tr><td><code>itn</code></td><td>boolean</td><td>设置是否使用 ITN，默认为 <code>true</code></td></tr><tr><td><code>svs_lang</code></td><td>string</td><td>设置 SenseVoiceSmall 模型语种，默认为 <code>&quot;auto&quot;</code></td></tr><tr><td><code>svs_itn</code></td><td>boolean</td><td>设置 SenseVoiceSmall 模型是否开启标点、ITN，默认为 <code>true</code></td></tr></tbody></table><p><strong>发送音频数据：</strong></p><p>直接将音频数据（移除头部信息后的 bytes 数据）发送，支持音频采样率为 8000（需要在 <code>message</code> 中指定 <code>audio_fs</code> 为 8000）或 16000。</p><p><strong>发送结束标志：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="服务端-→-客户端-1" tabindex="-1">服务端 → 客户端 <a class="header-anchor" href="#服务端-→-客户端-1" aria-label="Permalink to &quot;服务端 → 客户端&quot;">​</a></h4><p><strong>识别结果消息：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2pass-online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;asr outputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[[100,200], [200,500]]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;stamp_sents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>注意：</strong> 上面的示例是 <code>2pass-online</code> 的实时结果（<code>is_final: false</code>）。如果是 <code>2pass-offline</code> 的修正结果，则 <code>is_final: true</code>。</p><p><strong>参数说明：</strong></p><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>mode</code></td><td>string</td><td>表示推理模式，分为：<br>- <code>&quot;2pass-online&quot;</code>：实时识别结果（<code>is_final: false</code>）<br>- <code>&quot;2pass-offline&quot;</code>：2 遍修正识别结果（<code>is_final: true</code>，更准确）<br>- <code>&quot;online&quot;</code>：在线模式识别结果</td></tr><tr><td><code>wav_name</code></td><td>string</td><td>推理的音频文件名</td></tr><tr><td><code>text</code></td><td>string</td><td>语音识别输出文本</td></tr><tr><td><code>is_final</code></td><td>boolean</td><td>表示识别结束：<br>- <code>false</code>：中间结果（实时更新）<br>- <code>true</code>：最终结果</td></tr><tr><td><code>timestamp</code></td><td>string</td><td>如果 AM 为时间戳模型，会返回此字段，表示字级别时间戳</td></tr><tr><td><code>stamp_sents</code></td><td>array</td><td>如果 AM 为时间戳模型，会返回此字段，表示句子级别时间戳</td></tr></tbody></table><h3 id="_5-4-客户端发送模式-vs-服务端返回模式" tabindex="-1">5.4 客户端发送模式 vs 服务端返回模式 <a class="header-anchor" href="#_5-4-客户端发送模式-vs-服务端返回模式" aria-label="Permalink to &quot;5.4 客户端发送模式 vs 服务端返回模式&quot;">​</a></h3><p><strong>重要理解：</strong> 客户端发送的模式和服务端返回的模式可能不一致！</p><table tabindex="0"><thead><tr><th>客户端发送</th><th>服务端可能返回</th><th>说明</th></tr></thead><tbody><tr><td><code>&quot;offline&quot;</code></td><td><code>&quot;offline&quot;</code></td><td>一对一对应</td></tr><tr><td><code>&quot;online&quot;</code></td><td><code>&quot;online&quot;</code></td><td>一对一对应</td></tr><tr><td><code>&quot;2pass&quot;</code></td><td><code>&quot;2pass-online&quot;</code><br><code>&quot;2pass-offline&quot;</code></td><td><strong>一对多</strong>：客户端发送 <code>&quot;2pass&quot;</code>，服务端会返回两种模式的结果</td></tr></tbody></table><p><strong>为什么 2pass 模式会返回两种结果？</strong></p>`,39)),(a(),l(p,null,{default:i(()=>[h(n,{id:"mermaid-2588",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20Client%20as%20%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%20%20%20%20participant%20Server%20as%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%20mode%3A%20%222pass%22%0A%20%20%20%20Client-%3E%3EServer%3A%20%E6%8C%81%E7%BB%AD%E5%8F%91%E9%80%81%E9%9F%B3%E9%A2%91%E6%B5%81%0A%20%20%20%20%0A%20%20%20%20loop%20%E5%AE%9E%E6%97%B6%E8%AF%86%E5%88%AB%0A%20%20%20%20%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%20mode%3A%20%222pass-online%22%3Cbr%2F%3Eis_final%3A%20false%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Client-%3E%3EServer%3A%20%E5%8F%91%E9%80%81%20is_speaking%3A%20false%0A%20%20%20%20Server-%3E%3EServer%3A%20%E4%BD%BF%E7%94%A8%E7%A6%BB%E7%BA%BF%E6%A8%A1%E5%9E%8B%E4%BF%AE%E6%AD%A3%0A%20%20%20%20Server-%3E%3EClient%3A%20%E8%BF%94%E5%9B%9E%20mode%3A%20%222pass-offline%22%3Cbr%2F%3Eis_final%3A%20true%0A"})]),fallback:i(()=>[...s[5]||(s[5]=[e(" Loading... ",-1)])]),_:1})),s[12]||(s[12]=t(`<p>当客户端发送 <code>mode: &quot;2pass&quot;</code> 时：</p><ol><li>服务端首先使用在线模型实时识别，返回 <code>mode: &quot;2pass-online&quot;</code>，<code>is_final: false</code></li><li>在句尾或音频结束时，服务端使用离线模型进行修正，返回 <code>mode: &quot;2pass-offline&quot;</code>，<code>is_final: true</code></li></ol><p>这样设计的好处是：客户端可以同时获得实时反馈和最终准确结果。</p><h3 id="_5-5-模式选择机制-sdk-部署" tabindex="-1">5.5 模式选择机制（SDK 部署） <a class="header-anchor" href="#_5-5-模式选择机制-sdk-部署" aria-label="Permalink to &quot;5.5 模式选择机制（SDK 部署）&quot;">​</a></h3><p><strong>⚠️ 重要理解：启动脚本决定模式支持能力，模式选择在客户端！</strong></p><blockquote><p><strong>说明</strong>：本节主要介绍 <strong>SDK 部署（10095）</strong> 的模式选择机制。<strong>Python 服务器（10096）</strong> 的模式支持方式可能不同，详见 3.2 节和 3.6 节。</p></blockquote><p>对于 <strong>SDK 部署（10095）</strong>，模式支持能力取决于启动时使用的脚本：</p><ul><li><strong>使用 <code>run_server.sh</code></strong>：只支持 <code>offline</code> 模式，客户端发送任何 <code>mode</code> 都按 offline 处理</li><li><strong>使用 <code>run_server_2pass.sh</code></strong>：支持所有模式（offline、online、2pass），客户端可以通过 <code>mode</code> 参数动态切换</li></ul><p><strong>模式选择机制：</strong></p><p>当使用 <code>run_server_2pass.sh</code> 启动服务时，模式的选择不是在服务端部署时决定的，而是在客户端使用时通过 WebSocket 消息中的 <code>mode</code> 参数选择的。</p><h4 id="客户端如何选择模式" tabindex="-1">客户端如何选择模式 <a class="header-anchor" href="#客户端如何选择模式" aria-label="Permalink to &quot;客户端如何选择模式&quot;">​</a></h4><p>服务端部署后，客户端通过 WebSocket 连接，在首次发送的 JSON 消息中指定 <code>mode</code> 参数来选择使用哪个模式：</p><p><strong>使用 offline 模式：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 客户端首次消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;audio_fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 然后一次性发送完整音频数据</span></span></code></pre></div><p><strong>使用 online 模式：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 客户端首次消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;chunk_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;audio_fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 然后持续发送音频流（chunk by chunk）</span></span></code></pre></div><p><strong>使用 2pass 模式：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 客户端首次消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2pass&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pcm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_speaking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;chunk_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;audio_fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 然后持续发送音频流（chunk by chunk）</span></span></code></pre></div><h4 id="offline-vs-online-模式的关键区别" tabindex="-1">offline vs online 模式的关键区别 <a class="header-anchor" href="#offline-vs-online-模式的关键区别" aria-label="Permalink to &quot;offline vs online 模式的关键区别&quot;">​</a></h4><table tabindex="0"><thead><tr><th>维度</th><th>offline 模式</th><th>online/2pass 模式</th></tr></thead><tbody><tr><td><strong>启动脚本</strong></td><td><code>run_server.sh</code> 或 <code>run_server_2pass.sh</code></td><td>必须使用 <code>run_server_2pass.sh</code></td></tr><tr><td><strong>可执行文件</strong></td><td><code>funasr-wss-server</code> 或 <code>funasr-wss-server-2pass</code></td><td><code>funasr-wss-server-2pass</code></td></tr><tr><td><strong>服务端支持</strong></td><td>✅ <code>run_server.sh</code> 仅支持 offline<br>✅ <code>run_server_2pass.sh</code> 支持所有模式</td><td>✅ 仅 <code>run_server_2pass.sh</code> 支持</td></tr><tr><td><strong>客户端发送的 mode</strong></td><td><code>&quot;offline&quot;</code></td><td><code>&quot;online&quot;</code> 或 <code>&quot;2pass&quot;</code></td></tr><tr><td><strong>客户端首次消息</strong></td><td><code>{&quot;mode&quot;: &quot;offline&quot;, ...}</code></td><td><code>{&quot;mode&quot;: &quot;online&quot;, &quot;chunk_size&quot;: [5,10,5], ...}</code></td></tr><tr><td><strong>客户端发送方式</strong></td><td>一次性发送完整音频</td><td>持续发送音频流（chunk by chunk）</td></tr><tr><td><strong>客户端 chunk_size</strong></td><td>❌ 不需要</td><td>✅ 必需（如 <code>[5,10,5]</code>）</td></tr><tr><td><strong>服务端处理方式</strong></td><td>等待完整音频后一次性处理</td><td>实时处理每个音频片段</td></tr><tr><td><strong>返回结果</strong></td><td>只返回一次（<code>is_final: False</code>）</td><td>持续返回中间结果和最终结果</td></tr></tbody></table><p><strong>总结：</strong></p><ul><li>⚠️ <strong>启动脚本决定模式支持</strong>：使用 <code>run_server.sh</code> 只支持 offline，使用 <code>run_server_2pass.sh</code> 支持所有模式</li><li>✅ <strong>模式选择在客户端</strong>：使用 <code>run_server_2pass.sh</code> 时，客户端通过 WebSocket 消息中的 <code>mode</code> 参数选择使用哪个模式</li><li>✅ <strong>同一个服务端可以同时处理不同模式</strong>：使用 <code>run_server_2pass.sh</code> 时，不同的客户端连接可以使用不同的模式</li><li>✅ <strong>灵活高效</strong>：根据需求选择合适的启动脚本，<code>run_server_2pass.sh</code> 可以满足所有需求</li></ul><h3 id="_5-6-返回值类型详解" tabindex="-1">5.6 返回值类型详解 <a class="header-anchor" href="#_5-6-返回值类型详解" aria-label="Permalink to &quot;5.6 返回值类型详解&quot;">​</a></h3><h4 id="离线模式-offline-返回值" tabindex="-1">离线模式（offline）返回值 <a class="header-anchor" href="#离线模式-offline-返回值" aria-label="Permalink to &quot;离线模式（offline）返回值&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是识别结果。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[[100,200], [200,500], [500,800]]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;stamp_sents&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;text_seg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这 是 识 别&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;punc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;，&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;ts_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;text_seg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;结 果&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;punc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;ts_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">650</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">650</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>特点：</strong></p><ul><li><code>is_final</code> 为 <code>False</code>（<strong>注意：虽然为 False，但服务端只会返回一次结果，这实际上就是最终结果</strong>）</li><li>返回完整的识别文本</li><li>如果使用时间戳模型，会包含详细的时间戳信息</li></ul><h4 id="实时模式-online-返回值" tabindex="-1">实时模式（online）返回值 <a class="header-anchor" href="#实时模式-online-返回值" aria-label="Permalink to &quot;实时模式（online）返回值&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 中间结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stream.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 继续识别...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stream.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是识别&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 最终结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stream.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是识别结果。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>特点：</strong></p><ul><li>持续返回 <code>is_final: false</code> 的中间结果</li><li>最后返回 <code>is_final: true</code> 的最终结果</li><li>文本内容逐步完善</li></ul><h4 id="_2pass-模式返回值" tabindex="-1">2pass 模式返回值 <a class="header-anchor" href="#_2pass-模式返回值" aria-label="Permalink to &quot;2pass 模式返回值&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 实时识别结果（2pass-online）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2pass-online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stream.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是识别&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 继续实时识别...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2pass-online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stream.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是识别结果&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 离线修正结果（2pass-offline）- 更准确</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2pass-offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;wav_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stream.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;这是识别结果。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;is_final&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>特点：</strong></p><ul><li>先返回 <code>mode: &quot;2pass-online&quot;</code> 的实时结果（<code>is_final: false</code>）</li><li>最后返回 <code>mode: &quot;2pass-offline&quot;</code> 的修正结果（<code>is_final: true</code>）</li><li><code>2pass-offline</code> 结果更准确，但延迟更高</li></ul><h3 id="_5-7-热词配置" tabindex="-1">5.7 热词配置 <a class="header-anchor" href="#_5-7-热词配置" aria-label="Permalink to &quot;5.7 热词配置&quot;">​</a></h3><p>热词用于提高特定词汇的识别准确率。热词权重仅在 fst 热词服务下生效。</p><p><strong>客户端热词（JSON 字符串格式）：</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;hotwords&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">阿里巴巴</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:20,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">通义实验室</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:30,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">达摩院</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:25}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>服务端热词（文件格式）：</strong></p><p>在宿主机创建热词文件 <code>./funasr-runtime-resources/models/hotwords.txt</code>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>阿里巴巴 20</span></span>
<span class="line"><span>通义实验室 30</span></span>
<span class="line"><span>达摩院 25</span></span></code></pre></div><p>启动服务时指定热词文件：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --hotword</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models/hotwords.txt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ...</span></span></code></pre></div><p><strong>注意：</strong></p><ul><li>服务端热词全局生效</li><li>客户端热词只针对对应客户端生效</li><li>如果客户端提供热词，则与服务端热词合并使用</li><li>建议热词长度不超过 10，个数不超过 1k，权重 1~100</li></ul><h2 id="六、常见问题" tabindex="-1">六、常见问题 <a class="header-anchor" href="#六、常见问题" aria-label="Permalink to &quot;六、常见问题&quot;">​</a></h2><h3 id="_6-1-模型下载慢" tabindex="-1">6.1 模型下载慢 <a class="header-anchor" href="#_6-1-模型下载慢" aria-label="Permalink to &quot;6.1 模型下载慢&quot;">​</a></h3><p>首次启动会自动从 ModelScope 下载模型，可能需要几分钟到十几分钟，请耐心等待。模型会下载到挂载的目录 <code>./funasr-runtime-resources/models</code>。</p><h3 id="_6-2-端口被占用" tabindex="-1">6.2 端口被占用 <a class="header-anchor" href="#_6-2-端口被占用" aria-label="Permalink to &quot;6.2 端口被占用&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查端口占用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tlnp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10095</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改端口（在启动命令中添加，可以改为任意可用端口）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_server.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10097</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span></code></pre></div><p><strong>注意：</strong> 端口号只是默认值，SDK 部署默认 10095，Python 服务器默认 10096，都可以通过 <code>--port</code> 参数修改为任意可用端口。</p><h3 id="_6-3-容器立即退出" tabindex="-1">6.3 容器立即退出 <a class="header-anchor" href="#_6-3-容器立即退出" aria-label="Permalink to &quot;6.3 容器立即退出&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看容器日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">container_i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看退出原因</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">container_i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;State&quot;</span></span></code></pre></div><h3 id="_6-4-服务启动失败" tabindex="-1">6.4 服务启动失败 <a class="header-anchor" href="#_6-4-服务启动失败" aria-label="Permalink to &quot;6.4 服务启动失败&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看详细日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查模型是否正确下载</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /workspace/models/</span></span></code></pre></div><h3 id="_6-5-识别结果不准确" tabindex="-1">6.5 识别结果不准确 <a class="header-anchor" href="#_6-5-识别结果不准确" aria-label="Permalink to &quot;6.5 识别结果不准确&quot;">​</a></h3><ul><li>检查音频采样率是否匹配（16k 或 8k）</li><li>确认音频格式是否正确（PCM 格式需要指定 <code>audio_fs</code>）</li><li>尝试使用热词提高特定词汇识别率</li><li>考虑使用 <code>2pass</code> 模式获得更准确的结果</li></ul><h2 id="七、总结" tabindex="-1">七、总结 <a class="header-anchor" href="#七、总结" aria-label="Permalink to &quot;七、总结&quot;">​</a></h2><p>FunASR 提供了完整的语音识别解决方案，关键要点总结：</p><h3 id="模式选择" tabindex="-1">模式选择 <a class="header-anchor" href="#模式选择" aria-label="Permalink to &quot;模式选择&quot;">​</a></h3><ul><li><strong>offline</strong>：最简单，适合录音后识别，只返回一次最终结果</li><li><strong>online</strong>：实时反馈，适合实时语音输入，持续返回中间结果</li><li><strong>2pass</strong>：兼顾实时性和准确度，先给实时结果，再给修正结果</li></ul><h3 id="部署选择" tabindex="-1">部署选择 <a class="header-anchor" href="#部署选择" aria-label="Permalink to &quot;部署选择&quot;">​</a></h3><ul><li><strong>SDK 部署（C++ 实现）</strong>：生产环境推荐，性能最优，高并发，默认端口 10095</li><li><strong>Python 服务器部署</strong>：开发测试推荐，易于调试，无需 Docker，默认端口 10096</li><li><strong>端口可修改</strong>：两种部署方式的端口都可以通过 <code>--port</code> 参数修改，端口号只是默认值</li></ul><h3 id="通信协议" tabindex="-1">通信协议 <a class="header-anchor" href="#通信协议" aria-label="Permalink to &quot;通信协议&quot;">​</a></h3><ul><li>基于 WebSocket，JSON 配置 + 二进制音频数据</li><li>客户端发送的模式和服务端返回的模式可能不一致（特别是 2pass 模式）</li><li>理解 <code>is_final</code> 标志的重要性： <ul><li><code>false</code>：在 offline 模式下，虽然为 false，但这是唯一一次返回，实际上就是最终结果</li><li><code>false</code>：在 online/2pass 模式下，表示中间结果（实时更新）</li><li><code>true</code>：在 online/2pass 模式下，表示最终结果</li></ul></li></ul><h3 id="模式选择机制" tabindex="-1">模式选择机制 <a class="header-anchor" href="#模式选择机制" aria-label="Permalink to &quot;模式选择机制&quot;">​</a></h3><ul><li><strong>SDK 部署（10095）</strong>： <ul><li>使用 <code>run_server.sh</code>：只支持 <code>offline</code> 模式</li><li>使用 <code>run_server_2pass.sh</code>：支持所有模式（offline、online、2pass），客户端通过 <code>mode</code> 参数动态切换</li></ul></li><li><strong>模式选择在客户端</strong>：使用 <code>run_server_2pass.sh</code> 时，客户端发送不同的 <code>mode</code> 参数即可使用不同模式</li><li><strong>详细说明</strong>：详见 3.2 节（启动脚本说明）和 5.5 节（模式选择机制）</li></ul><h3 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h3><ol><li><strong>录音后识别场景</strong>： <ul><li>使用 <code>run_server.sh</code> 启动服务（只支持 offline 模式）</li><li>客户端使用 <code>offline</code> 模式，最简单高效</li></ul></li><li><strong>需要多种模式场景</strong>： <ul><li>使用 <code>run_server_2pass.sh</code> 启动服务（支持所有模式）</li><li>客户端根据需要选择 <code>offline</code>、<code>online</code> 或 <code>2pass</code> 模式</li></ul></li><li><strong>生产环境</strong>：使用 SDK 部署（C++ 实现，高性能）</li><li><strong>开发测试</strong>：使用 Python 服务器部署（易于调试）</li><li><strong>部署建议</strong>： <ul><li>如果只需要录音后识别 → 使用 <code>run_server.sh</code>（资源占用更少）</li><li>如果需要多种模式 → 使用 <code>run_server_2pass.sh</code>（功能更全面）</li></ul></li></ol><p>选择合适的模式和部署方式，可以满足从文件转写到实时语音识别的各种需求。</p><h2 id="八、参考文档" tabindex="-1">八、参考文档 <a class="header-anchor" href="#八、参考文档" aria-label="Permalink to &quot;八、参考文档&quot;">​</a></h2><ul><li><a href="https://github.com/modelscope/FunASR" target="_blank" rel="noreferrer">FunASR 官方仓库</a></li><li><a href="https://github.com/modelscope/FunASR/blob/main/runtime/docs/SDK_advanced_guide_offline_zh.md" target="_blank" rel="noreferrer">SDK 部署指南</a></li><li><a href="https://github.com/modelscope/FunASR/blob/main/runtime/docs/websocket_protocol_zh.md" target="_blank" rel="noreferrer">WebSocket 通信协议</a></li><li><a href="https://www.modelscope.cn/models?page=1&amp;tasks=automatic-speech-recognition" target="_blank" rel="noreferrer">ModelScope 模型库</a></li></ul>`,73))])}const m=d(k,[["render",E]]);export{B as __pageData,m as default};
