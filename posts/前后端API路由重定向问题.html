<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前后端API路由重定向问题 | QianFan</title>
    <meta name="description" content="解决 Vue + Vite 项目中遇到的 API 请求执行两遍的问题。深入分析 Vite proxy 配置与 FastAPI 路由斜杠不匹配导致的 307 重定向问题，提供完整的排查方法和解决方案。">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BVXFa7f4.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BBXJCu8u.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.DXI-tbPr.js">
    <link rel="modulepreload" href="/assets/chunks/theme.b8rjx6P7.js">
    <link rel="modulepreload" href="/assets/chunks/katex.BbEIqZs1.js">
    <link rel="modulepreload" href="/assets/chunks/dagre-6UL2VRFP.DB2JwBba.js">
    <link rel="modulepreload" href="/assets/chunks/cose-bilkent-S5V4N54A.B3tmlXXm.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-YG6GDRKO.Cwjvy5yR.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-NV44I4VS.BdE8CmRs.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-Q2GNP2WA.Be6udrqF.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-NY62KEGX.D9XY7GYC.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-LVOFAZNH.Dcm4dwIV.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-ER5ION4S.CjMUxQ4c.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-ADFJNKIX.PkHHTYUB.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-AYHSOK5B.zsEYXCPj.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-PRI3JC2R.KjAfg4x_.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-UZGBJVZJ.C_Ztnyws.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-WL72ISMW.COTkjupJ.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-2ON5EDUG.BhWBBXTM.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-WZHVMYZB.BhWBBXTM.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-FKZM4ZOC.BpRfYLSN.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-4FDKWEC3.dunHU1dQ.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-XKPGCS4Q.DTU9ixf7.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-IT6M3QCI.Dd83ce_t.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-VGOIOE7T.Cw_rDB9M.js">
    <link rel="modulepreload" href="/assets/chunks/kanban-definition-3W4ZIXB7.DhbvCtw7.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-TZEHDZUN.CxEWIJQZ.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-S2PKOQOG.Dh6t4IBy.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-QEK2KX5R.BBrrBnUA.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-VD42YOAC.CTDrurvT.js">
    <link rel="modulepreload" href="/assets/chunks/architectureDiagram-VXUJARFQ.DUnerbvj.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-PSM6KHXK.B2GWaz6y.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/posts_前后端API路由重定向问题.md.BRgYLl_6.lean.js">
    <link rel="icon" type="image/jpg" href="/QianFan.jpg">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="author" content="QianFan">
    <meta property="og:title" content="Home">
    <meta property="og:description" content="Home of QianFan">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="layout-wrapper" data-v-38affe22><div class="Layout" data-v-38affe22 data-v-850ab906><!--[--><!--]--><!--[--><span tabindex="-1" data-v-21456531></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-21456531>Skip to content</a><!--]--><!----><header class="VPNav" data-v-850ab906 data-v-cf446907><div class="VPNavBar" data-v-cf446907 data-v-6eb24790><div class="wrapper" data-v-6eb24790><div class="container" data-v-6eb24790><div class="title" data-v-6eb24790><div class="VPNavBarTitle has-sidebar" data-v-6eb24790 data-v-19e2f64c><a class="title" href="/" data-v-19e2f64c><!--[--><!--]--><!--[--><img class="VPImage logo" src="/QianFan.jpg" alt data-v-4f51225a><!--]--><span data-v-19e2f64c>QianFan</span><!--[--><!--]--></a></div></div><div class="content" data-v-6eb24790><div class="content-body" data-v-6eb24790><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6eb24790><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6eb24790 data-v-7a608cf3><span id="main-nav-aria-label" class="visually-hidden" data-v-7a608cf3> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7a608cf3 data-v-ec38c768><!--[--><span data-v-ec38c768>🏡 首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/posts/" tabindex="0" data-v-7a608cf3 data-v-ec38c768><!--[--><span data-v-ec38c768>📚 博客</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about" tabindex="0" data-v-7a608cf3 data-v-ec38c768><!--[--><span data-v-ec38c768>👤 关于</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6eb24790 data-v-d6d9c22b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-d6d9c22b data-v-ed6ed1d6 data-v-0f618858><span class="check" data-v-0f618858><span class="icon" data-v-0f618858><!--[--><span class="vpi-sun sun" data-v-ed6ed1d6></span><span class="vpi-moon moon" data-v-ed6ed1d6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6eb24790 data-v-17a16bac data-v-9170378a><!--[--><a class="VPSocialLink no-icon" href="https://github.com/helloAhao096" aria-label="github" target="_blank" rel="noopener" data-v-9170378a data-v-713e5710><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="mailto:helloahao@icloud.com" aria-label target="_blank" rel="noopener" data-v-9170378a data-v-713e5710><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
            <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
            </svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6eb24790 data-v-a6b3d708 data-v-98e7be0f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-98e7be0f><span class="vpi-more-horizontal icon" data-v-98e7be0f></span></button><div class="menu" data-v-98e7be0f><div class="VPMenu" data-v-98e7be0f data-v-e1050040><!----><!--[--><!--[--><!----><div class="group" data-v-a6b3d708><div class="item appearance" data-v-a6b3d708><p class="label" data-v-a6b3d708>Appearance</p><div class="appearance-action" data-v-a6b3d708><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-a6b3d708 data-v-ed6ed1d6 data-v-0f618858><span class="check" data-v-0f618858><span class="icon" data-v-0f618858><!--[--><span class="vpi-sun sun" data-v-ed6ed1d6></span><span class="vpi-moon moon" data-v-ed6ed1d6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-a6b3d708><div class="item social-links" data-v-a6b3d708><div class="VPSocialLinks social-links-list" data-v-a6b3d708 data-v-9170378a><!--[--><a class="VPSocialLink no-icon" href="https://github.com/helloAhao096" aria-label="github" target="_blank" rel="noopener" data-v-9170378a data-v-713e5710><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="mailto:helloahao@icloud.com" aria-label target="_blank" rel="noopener" data-v-9170378a data-v-713e5710><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
            <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
            </svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6eb24790 data-v-7b132a62><span class="container" data-v-7b132a62><span class="top" data-v-7b132a62></span><span class="middle" data-v-7b132a62></span><span class="bottom" data-v-7b132a62></span></span></button></div></div></div></div><div class="divider" data-v-6eb24790><div class="divider-line" data-v-6eb24790></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-850ab906 data-v-8a7258f9><div class="container" data-v-8a7258f9><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-8a7258f9><span class="vpi-align-left menu-icon" data-v-8a7258f9></span><span class="menu-text" data-v-8a7258f9>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-8a7258f9 data-v-8a01e7c8><button data-v-8a01e7c8>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-850ab906 data-v-83a3c394><div class="curtain" data-v-83a3c394></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-83a3c394><span class="visually-hidden" id="sidebar-aria-label" data-v-83a3c394> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-b567d063><section class="VPSidebarItem level-0 collapsible" data-v-b567d063 data-v-0abeec80><div class="item" role="button" tabindex="0" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><h2 class="text" data-v-0abeec80>2026年</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0abeec80><span class="vpi-chevron-right caret-icon" data-v-0abeec80></span></div></div><div class="items" data-v-0abeec80><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Alembic%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Alembic 数据库迁移完整指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/FunASR%20%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>FunASR 语音识别部署和使用指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Celery%20%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Celery 异步任务队列完整指南</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b567d063><section class="VPSidebarItem level-0 collapsible has-active" data-v-b567d063 data-v-0abeec80><div class="item" role="button" tabindex="0" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><h2 class="text" data-v-0abeec80>2025年</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0abeec80><span class="vpi-chevron-right caret-icon" data-v-0abeec80></span></div></div><div class="items" data-v-0abeec80><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E5%89%8D%E5%90%8E%E7%AB%AFAPI%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91%E9%97%AE%E9%A2%98" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>前后端API路由重定向问题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/LangChain%20PGVectorStore%20%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>LangChain PGVectorStore 完整指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E5%8D%83%E5%B8%86%E8%B4%A2%E5%AF%8C%E8%87%AA%E7%94%B1%E8%AE%A1%E5%88%92" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>千帆财富自由计划</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Git%20Branch%20%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Git Branch 分支管理规范指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Git%20Commit%20%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Git Commit 提交规范指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/uv%20Python%20%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>uv Python 包管理器使用指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/gitignore%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>.gitignore 配置指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E5%85%A8%E6%A0%88%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>FastAPI + Vue 3 全栈项目目录结构设计指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/FastAPI%20%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>FastAPI 项目工程化结构设计指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Vue%203%20%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Vue 3 项目工程化结构设计指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/giscus%E8%AF%84%E8%AE%BA%E9%85%8D%E7%BD%AE" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>giscus 评论插件配置指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/OpenSpec%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>OpenSpec 使用指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/GitHub%20Action%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B%E8%AF%A6%E8%A7%A3" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>GitHub Action完整示例详解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/LangGraph%20%E4%BA%BA%E6%9C%BA%E7%8E%AF%E8%B7%AF%20interrupt" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>LangGraph 人机环路 interrupt</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b567d063><section class="VPSidebarItem level-0 collapsible" data-v-b567d063 data-v-0abeec80><div class="item" role="button" tabindex="0" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><h2 class="text" data-v-0abeec80>2024年</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0abeec80><span class="vpi-chevron-right caret-icon" data-v-0abeec80></span></div></div><div class="items" data-v-0abeec80><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/docker%20%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E3%80%81%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E6%BA%90" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>docker 自动化安装部署、配置镜像源</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/linux%20service%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>linux service服务配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/postgresql%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>postgresql 常用命令</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Homebrew%20%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86&amp;%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F%E6%BA%90" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Homebrew 设置代理&国内镜像源</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/vue&amp;vite%E7%9A%84api%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82proxy%E8%AE%BE%E7%BD%AE" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>vue&vite的api网络请求proxy设置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/vue%E9%A1%B9%E7%9B%AEvite%E5%85%A8%E5%B1%80%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>vue项目vite全局静态变量配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/linux%E8%BF%9E%E6%8E%A5%E8%93%9D%E7%89%99%E8%AE%BE%E5%A4%87" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>linux连接蓝牙设备📶</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b567d063><section class="VPSidebarItem level-0 collapsible" data-v-b567d063 data-v-0abeec80><div class="item" role="button" tabindex="0" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><h2 class="text" data-v-0abeec80>2023年</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0abeec80><span class="vpi-chevron-right caret-icon" data-v-0abeec80></span></div></div><div class="items" data-v-0abeec80><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/linux%E6%8C%82%E8%BD%BDu%E7%9B%98%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>linux挂载硬盘拷贝文件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/ubuntu22.04%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AEWLAN&amp;WIFI%E5%9B%BA%E5%AE%9Aip" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>ubuntu22.04网络配置WLAN&WIFI固定ip</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E6%A0%91%E8%8E%93%E6%B4%BE4b%E9%85%8D%E7%BD%AEwatchdog" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>树莓派4b配置watchdog</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/osm%E7%A6%BB%E7%BA%BF%E5%9C%B0%E5%9B%BEdocker%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E6%B5%81%E7%A8%8B" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>osm离线地图docker服务器搭建流程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E8%BD%A6%E6%9C%BA%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>车机安装第三方应用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/GitHub%20Action%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>GitHub Action一键部署个人博客</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/Gitalk%E9%85%8D%E7%BD%AE" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>Gitalk配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/vitepress%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E8%B7%AF%E7%94%B1" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>vitepress自定义静态文件路由</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E4%B8%8D%E8%92%9C%E5%AD%90%20%E7%BD%91%E7%AB%99%E8%AE%A1%E6%95%B0%E5%99%A8" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>vitepress中使用不蒜子网站计数器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0abeec80 data-v-0abeec80><div class="item" data-v-0abeec80><div class="indicator" data-v-0abeec80></div><a class="VPLink link link" href="/posts/%E7%BD%91%E7%AB%99%E8%87%AA%E5%AE%9A%E4%B9%89%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6" data-v-0abeec80><!--[--><p class="text" data-v-0abeec80>网站自定义鼠标事件</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-850ab906 data-v-4d48dfda><div class="VPDoc has-sidebar has-aside" data-v-4d48dfda data-v-8b9a1a38><!--[--><!--]--><div class="container" data-v-8b9a1a38><div class="aside" data-v-8b9a1a38><div class="aside-curtain" data-v-8b9a1a38></div><div class="aside-container" data-v-8b9a1a38><div class="aside-content" data-v-8b9a1a38><div class="VPDocAside" data-v-8b9a1a38 data-v-0c3fa5b7><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-0c3fa5b7 data-v-3e9630cc><div class="content" data-v-3e9630cc><div class="outline-marker" data-v-3e9630cc></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-3e9630cc>本页目录</div><ul class="VPDocOutlineItem root" data-v-3e9630cc data-v-b81b42d0><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-0c3fa5b7></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-8b9a1a38><div class="content-container" data-v-8b9a1a38><!--[--><!--[--><!--[--><section class="post-title" data-v-38affe22 data-v-e5b83d27><h1 class="title" data-v-e5b83d27>前后端API路由重定向问题</h1><blockquote class="description" data-v-e5b83d27><p class="description-text" data-v-e5b83d27>解决 Vue + Vite 项目中遇到的 API 请求执行两遍的问题。深入分析 Vite proxy 配置与 FastAPI 路由斜杠不匹配导致的 307 重定向问题，提供完整的排查方法和解决方案。</p></blockquote><section class="meta-block" data-v-e5b83d27><div class="meta-row" data-v-e5b83d27><span class="meta-leading" data-v-e5b83d27><span class="meta-emoji" aria-hidden="true" data-v-e5b83d27>🗓️</span><span class="meta-label" data-v-e5b83d27>发布时间</span></span><span class="meta-value" data-v-e5b83d27>2025-12-25 17:37:03</span></div><div class="meta-row meta-row-tags" data-v-e5b83d27><span class="meta-leading" data-v-e5b83d27><span class="meta-emoji" aria-hidden="true" data-v-e5b83d27>🏷️</span><span class="meta-label" data-v-e5b83d27>标签</span></span><div class="meta-value" data-v-e5b83d27><!--[--><a href="/posts/?tag=FastAPI" class="meta-tag" data-v-e5b83d27>FastAPI</a><a href="/posts/?tag=Python" class="meta-tag" data-v-e5b83d27>Python</a><a href="/posts/?tag=Vue" class="meta-tag" data-v-e5b83d27>Vue</a><!--]--></div></div></section></section><!----><!--]--><!--]--><!--]--><main class="main" data-v-8b9a1a38><div style="position:relative;" class="vp-doc _posts_%E5%89%8D%E5%90%8E%E7%AB%AFAPI%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91%E9%97%AE%E9%A2%98" data-v-8b9a1a38><div><blockquote><p>在使用 Vue + Vite 开发前端项目，配合 FastAPI 后端时，可能会遇到 API 请求执行两遍的问题。这是因为 Vite 的 proxy 配置将请求转发到后端（5173 → 8000），而后端路由定义与请求路径的末尾斜杠不匹配，导致返回 307 重定向，浏览器再次请求，造成每次 API 调用都执行两次。本文深入分析问题原因，提供完整的排查方法和解决方案。</p></blockquote><h2 id="一、问题现象" tabindex="-1">一、问题现象 <a class="header-anchor" href="#一、问题现象" aria-label="Permalink to &quot;一、问题现象&quot;">​</a></h2><h3 id="_1-1-实际场景描述" tabindex="-1">1.1 实际场景描述 <a class="header-anchor" href="#_1-1-实际场景描述" aria-label="Permalink to &quot;1.1 实际场景描述&quot;">​</a></h3><p><strong>开发环境配置：</strong></p><ul><li>前端：Vue 3 + Vite，运行在 <code>http://localhost:5173</code></li><li>后端：FastAPI，运行在 <code>http://localhost:8000</code></li><li>Vite proxy 配置：将 <code>/api</code> 请求代理到 <code>http://localhost:8000</code></li></ul><p><strong>问题表现：</strong></p><ol><li>前端发起 API 请求：<code>GET http://localhost:5173/api/v1/users</code></li><li>在浏览器 Network 标签中观察到<strong>每个请求都执行了两次</strong></li><li>第一次请求返回 <code>307 Temporary Redirect</code></li><li>第二次请求才返回正常的 <code>200 OK</code> 响应</li></ol><p><strong>实际观察到的现象：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Network 标签显示：</span></span>
<span class="line"><span>1. GET /api/v1/users → 307 Temporary Redirect</span></span>
<span class="line"><span>   Location: http://localhost:8000/api/v1/users/</span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>2. GET /api/v1/users/ → 200 OK</span></span>
<span class="line"><span>   [正常响应数据]</span></span></code></pre></div><h3 id="_1-2-问题影响" tabindex="-1">1.2 问题影响 <a class="header-anchor" href="#_1-2-问题影响" aria-label="Permalink to &quot;1.2 问题影响&quot;">​</a></h3><p><strong>性能影响：</strong></p><ul><li>每个 API 请求都执行两次，增加网络开销</li><li>响应时间翻倍，影响用户体验</li><li>增加服务器负载（后端处理两次请求）</li></ul><p><strong>开发体验影响：</strong></p><ul><li>调试困难，Network 标签中看到重复请求</li><li>可能影响某些依赖请求次数的功能（如请求去重、防抖等）</li><li>日志中看到重复的请求记录</li></ul><h3 id="_1-3-问题识别方法" tabindex="-1">1.3 问题识别方法 <a class="header-anchor" href="#_1-3-问题识别方法" aria-label="Permalink to &quot;1.3 问题识别方法&quot;">​</a></h3><p><strong>在浏览器开发者工具中检查：</strong></p><ol><li><strong>打开 Network 标签</strong></li><li><strong>发起一个 API 请求</strong>（如获取用户列表）</li><li><strong>观察请求记录</strong>： <ul><li>❌ <strong>异常情况</strong>：看到两个相同路径的请求，第一个返回 307，第二个返回 200</li><li>✅ <strong>正常情况</strong>：只有一个请求，直接返回 200</li></ul></li></ol><p><strong>典型异常请求记录：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Name              Status     Type     Size     Time</span></span>
<span class="line"><span>/api/v1/users     307        xhr      0 B      5 ms</span></span>
<span class="line"><span>/api/v1/users/    200        xhr      2.5 KB   15 ms</span></span></code></pre></div><p><strong>检查响应头：</strong></p><p>在第一个请求的 Response Headers 中，如果看到：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTP/1.1 307 Temporary Redirect</span></span>
<span class="line"><span>Location: http://localhost:8000/api/v1/users/</span></span></code></pre></div><p>说明存在重定向问题。</p><h2 id="二、问题原因分析" tabindex="-1">二、问题原因分析 <a class="header-anchor" href="#二、问题原因分析" aria-label="Permalink to &quot;二、问题原因分析&quot;">​</a></h2><h3 id="_2-1-完整请求流程" tabindex="-1">2.1 完整请求流程 <a class="header-anchor" href="#_2-1-完整请求流程" aria-label="Permalink to &quot;2.1 完整请求流程&quot;">​</a></h3><p><strong>正常情况下的请求流程：</strong></p><div class="mermaid"></div><p><strong>异常情况下的请求流程（存在重定向）：</strong></p><div class="mermaid"></div><h3 id="_2-2-vite-proxy-配置的作用" tabindex="-1">2.2 Vite Proxy 配置的作用 <a class="header-anchor" href="#_2-2-vite-proxy-配置的作用" aria-label="Permalink to &quot;2.2 Vite Proxy 配置的作用&quot;">​</a></h3><p><strong>Vite 的 proxy 配置示例：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:8000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // rewrite: (path) =&gt; path.replace(/^\/api/, &#39;&#39;)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 可选：重写路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>Proxy 工作流程：</strong></p><ol><li>浏览器请求：<code>GET http://localhost:5173/api/v1/users</code></li><li>Vite 拦截 <code>/api</code> 开头的请求</li><li>Vite 转发到：<code>GET http://localhost:8000/api/v1/users</code></li><li>后端处理请求并返回响应</li><li>Vite 将响应返回给浏览器</li></ol><p><strong>关键点：</strong></p><ul><li>Vite proxy <strong>只是转发请求</strong>，不修改路径</li><li>如果后端返回 307 重定向，浏览器会<strong>自动跟随重定向</strong></li><li>重定向后的请求<strong>仍然会经过 Vite proxy</strong></li></ul><h3 id="_2-3-fastapi-路由匹配机制" tabindex="-1">2.3 FastAPI 路由匹配机制 <a class="header-anchor" href="#_2-3-fastapi-路由匹配机制" aria-label="Permalink to &quot;2.3 FastAPI 路由匹配机制&quot;">​</a></h3><p>FastAPI 基于 Starlette 的路由系统，使用<strong>精确匹配</strong>原则：</p><ul><li>路由定义与请求路径必须<strong>完全一致</strong>（包括末尾斜杠）</li><li>匹配优先级：精确路径 &gt; 路径参数 &gt; 通配符</li></ul><p><strong>路由定义示例：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误：路由定义为 &quot;/&quot;，期望路径是 /api/v1/users/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求 /api/v1/users → 不匹配 → 307 重定向到 /api/v1/users/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：路由定义为 &quot;&quot;，期望路径是 /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 匹配 /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求 /api/v1/users → 直接匹配 → 200 OK</span></span></code></pre></div><h3 id="_2-4-redirect-slashes-工作原理" tabindex="-1">2.4 redirect_slashes 工作原理 <a class="header-anchor" href="#_2-4-redirect-slashes-工作原理" aria-label="Permalink to &quot;2.4 redirect_slashes 工作原理&quot;">​</a></h3><p>FastAPI 默认启用 <code>redirect_slashes=True</code>，当路由定义和请求路径的末尾斜杠不一致时：</p><ol><li>首先尝试精确匹配</li><li>如果精确匹配失败，检查是否存在&quot;相反&quot;路径（有/无末尾斜杠）</li><li>如果存在，返回 307 重定向到匹配的路径</li><li>如果不存在，返回 404</li></ol><p><strong>匹配规则表</strong>：</p><table tabindex="0"><thead><tr><th>路由定义</th><th>请求路径</th><th>匹配结果</th><th>说明</th></tr></thead><tbody><tr><td><code>@router.get(&quot;/&quot;, ...)</code></td><td><code>/api/v1/users</code></td><td>❌ 不匹配 → 307 → <code>/api/v1/users/</code></td><td>路由期望有斜杠，请求无斜杠，触发重定向</td></tr><tr><td><code>@router.get(&quot;&quot;, ...)</code></td><td><code>/api/v1/users/</code></td><td>❌ 不匹配 → 307 → <code>/api/v1/users</code></td><td>路由期望无斜杠，请求有斜杠，触发重定向</td></tr><tr><td><code>@router.get(&quot;/&quot;, ...)</code></td><td><code>/api/v1/users/</code></td><td>✅ 直接匹配</td><td>路径完全一致，直接匹配成功</td></tr><tr><td><code>@router.get(&quot;&quot;, ...)</code></td><td><code>/api/v1/users</code></td><td>✅ 直接匹配</td><td>路径完全一致，直接匹配成功</td></tr></tbody></table><h3 id="_2-5-问题产生的完整链路" tabindex="-1">2.5 问题产生的完整链路 <a class="header-anchor" href="#_2-5-问题产生的完整链路" aria-label="Permalink to &quot;2.5 问题产生的完整链路&quot;">​</a></h3><p><strong>问题场景还原：</strong></p><ol><li><strong>前端代码</strong>：</li></ol><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 前端发起请求（无末尾斜杠）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/v1/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ol start="2"><li><strong>Vite Proxy 转发</strong>：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>浏览器 → Vite (5173) → FastAPI (8000)</span></span>
<span class="line"><span>GET /api/v1/users → GET http://localhost:8000/api/v1/users</span></span></code></pre></div><ol start="3"><li><strong>后端路由定义</strong>（错误示例）：</li></ol><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误：期望路径是 /api/v1/users/</span></span></code></pre></div><ol start="4"><li><strong>路由匹配失败</strong>：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请求路径：/api/v1/users</span></span>
<span class="line"><span>路由期望：/api/v1/users/</span></span>
<span class="line"><span>结果：不匹配 → 返回 307 重定向</span></span>
<span class="line"><span>Location: http://localhost:8000/api/v1/users/</span></span></code></pre></div><ol start="5"><li><strong>浏览器自动跟随重定向</strong>：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>浏览器收到 307 → 自动发起新请求</span></span>
<span class="line"><span>GET /api/v1/users/ → Vite Proxy → GET http://localhost:8000/api/v1/users/</span></span></code></pre></div><ol start="6"><li><strong>第二次请求成功</strong>：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请求路径：/api/v1/users/</span></span>
<span class="line"><span>路由期望：/api/v1/users/</span></span>
<span class="line"><span>结果：匹配成功 → 返回 200 OK</span></span></code></pre></div><p><strong>结果：每个 API 请求都执行了两次！</strong></p><p><strong>实际场景示例</strong>：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景 1：路由定义为 &quot;/&quot;，请求为 &quot;/users&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 期望路径：/users/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求：GET /users</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 结果：307 → /users/（重定向）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景 2：路由定义为 &quot;&quot;，请求为 &quot;/users/&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 期望路径：/users</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求：GET /users/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 结果：307 → /users（重定向）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景 3：路由定义为 &quot;&quot;，请求为 &quot;/users&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 期望路径：/users</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求：GET /users</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 结果：200 OK（直接匹配）</span></span></code></pre></div><div class="mermaid"></div><h2 id="三、排查方法" tabindex="-1">三、排查方法 <a class="header-anchor" href="#三、排查方法" aria-label="Permalink to &quot;三、排查方法&quot;">​</a></h2><h3 id="_3-1-检查后端路由定义" tabindex="-1">3.1 检查后端路由定义 <a class="header-anchor" href="#_3-1-检查后端路由定义" aria-label="Permalink to &quot;3.1 检查后端路由定义&quot;">​</a></h3><p><strong>使用 grep 搜索问题路由：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在项目根目录执行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索所有使用 &quot;/&quot; 作为根路径的路由（这是问题根源）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.get(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.post(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.put(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.delete(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.patch(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span></code></pre></div><p><strong>如果找到类似这样的代码，就是问题所在：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 问题代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里使用了 &quot;/&quot;，导致只匹配 /api/v1/users/</span></span></code></pre></div><h3 id="_3-2-检查前端请求路径" tabindex="-1">3.2 检查前端请求路径 <a class="header-anchor" href="#_3-2-检查前端请求路径" aria-label="Permalink to &quot;3.2 检查前端请求路径&quot;">​</a></h3><p><strong>检查前端 API 定义：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 检查是否有添加末尾斜杠的情况</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ✅ 正确：无末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users/&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // ❌ 错误：有末尾斜杠</span></span></code></pre></div><p><strong>在浏览器 Network 标签中检查：</strong></p><ol><li>查看请求 URL 是否包含末尾斜杠</li><li>查看响应状态码是否为 307</li><li>查看响应头中是否有 <code>Location</code> 字段</li></ol><h3 id="_3-3-检查-vite-proxy-配置" tabindex="-1">3.3 检查 Vite Proxy 配置 <a class="header-anchor" href="#_3-3-检查-vite-proxy-配置" aria-label="Permalink to &quot;3.3 检查 Vite Proxy 配置&quot;">​</a></h3><p><strong>确认 Vite 配置是否正确：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:8000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 注意：不要在这里重写路径，保持原样转发</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>验证 Proxy 是否工作：</strong></p><ol><li>在浏览器 Network 标签中查看请求</li><li>确认请求确实被转发到后端（查看请求详情）</li><li>检查是否有路径被意外修改</li></ol><h2 id="四、解决方案" tabindex="-1">四、解决方案 <a class="header-anchor" href="#四、解决方案" aria-label="Permalink to &quot;四、解决方案&quot;">​</a></h2><h3 id="_4-1-核心原则" tabindex="-1">4.1 核心原则 <a class="header-anchor" href="#_4-1-核心原则" aria-label="Permalink to &quot;4.1 核心原则&quot;">​</a></h3><p><strong>前后端路径格式必须完全一致</strong>，遵循 RESTful API 规范：<strong>不使用末尾斜杠</strong>。</p><p><strong>关键点：</strong></p><ul><li>后端路由定义：根路径使用空字符串 <code>&quot;&quot;</code>，不使用 <code>&quot;/&quot;</code></li><li>前端请求路径：统一使用无末尾斜杠的路径</li><li>Vite proxy：保持原样转发，不修改路径</li></ul><h3 id="_4-2-修复步骤" tabindex="-1">4.2 修复步骤 <a class="header-anchor" href="#_4-2-修复步骤" aria-label="Permalink to &quot;4.2 修复步骤&quot;">​</a></h3><p><strong>步骤 1：修复后端路由定义</strong></p><p>找到所有使用 <code>&quot;/&quot;</code> 作为根路径的路由，改为空字符串 <code>&quot;&quot;</code>：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 修复前（错误）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 修复后（正确）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 匹配 /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 匹配 /api/v1/users</span></span></code></pre></div><p><strong>步骤 2：检查前端路径</strong></p><p>确保前端所有 API 路径都没有末尾斜杠：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：无末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> USER_API_ENDPOINTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LIST: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  DETAIL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 错误：有末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users/&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 会导致重定向</span></span></code></pre></div><p><strong>步骤 3：重启服务</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启后端服务</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启前端开发服务器（Vite）</span></span></code></pre></div><p><strong>步骤 4：验证修复</strong></p><p>在浏览器 Network 标签中检查：</p><ul><li>✅ 每个 API 请求只执行一次</li><li>✅ 响应状态码直接是 200/201，不是 307</li><li>✅ 响应头中没有 <code>Location</code> 字段</li></ul><h3 id="_4-3-后端路由定义规范" tabindex="-1">4.3 后端路由定义规范 <a class="header-anchor" href="#_4-3-后端路由定义规范" aria-label="Permalink to &quot;4.3 后端路由定义规范&quot;">​</a></h3><p><strong>核心规则：</strong></p><ul><li>✅ 根路径使用空字符串 <code>&quot;&quot;</code></li><li>✅ 子路径使用前导斜杠 <code>&quot;/{id}&quot;</code></li><li>❌ 根路径不使用 <code>&quot;/&quot;</code></li><li>❌ 子路径不使用 <code>&quot;{id}&quot;</code>（缺少前导斜杠）</li></ul><p><strong>完整示例：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fastapi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：根路径使用空字符串</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># POST /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PUT /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DELETE /api/v1/users</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：子路径使用前导斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/stats&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users/stats</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/items&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users/{id}/items</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误：根路径使用 &quot;/&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/，会导致重定向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/，会导致重定向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误：子路径缺少前导斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 路由注册失败</span></span></code></pre></div><h3 id="_4-4-前端-api-路径规范" tabindex="-1">4.4 前端 API 路径规范 <a class="header-anchor" href="#_4-4-前端-api-路径规范" aria-label="Permalink to &quot;4.4 前端 API 路径规范&quot;">​</a></h3><p><strong>核心规则：</strong></p><ul><li>✅ 统一使用无末尾斜杠的路径</li><li>✅ 使用常量定义 API 基础路径</li><li>❌ 不要添加末尾斜杠</li><li>❌ 不要在路径拼接时添加多余的斜杠</li></ul><p><strong>完整示例：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：使用常量定义，无末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> USER_API_ENDPOINTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LIST: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  CREATE: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  DETAIL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  STATS: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/stats`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/stats</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ITEMS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/items`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/{id}/items</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 错误：添加末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users/&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 会导致重定向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_ENDPOINTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LIST: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/ - 会导致重定向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_4-5-vite-proxy-配置规范" tabindex="-1">4.5 Vite Proxy 配置规范 <a class="header-anchor" href="#_4-5-vite-proxy-配置规范" aria-label="Permalink to &quot;4.5 Vite Proxy 配置规范&quot;">​</a></h3><p><strong>推荐配置：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:8000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 保持原样转发，不修改路径</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 不要使用 rewrite，除非有特殊需求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>注意事项：</strong></p><ul><li><code>changeOrigin: true</code>：确保请求头中的 <code>Host</code> 正确</li><li>不要使用 <code>rewrite</code> 修改路径，除非有特殊需求</li><li>保持路径原样转发，让后端处理路由匹配</li></ul><h3 id="_4-6-完整示例-vue-vite-fastapi" tabindex="-1">4.6 完整示例（Vue + Vite + FastAPI） <a class="header-anchor" href="#_4-6-完整示例-vue-vite-fastapi" aria-label="Permalink to &quot;4.6 完整示例（Vue + Vite + FastAPI）&quot;">​</a></h3><h4 id="后端路由定义" tabindex="-1">后端路由定义 <a class="header-anchor" href="#后端路由定义" aria-label="Permalink to &quot;后端路由定义&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fastapi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter, Depends, HTTPException</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pydantic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BaseModel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建路由，使用 prefix 定义基础路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;用户管理&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：根路径使用空字符串</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List[User])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> list_users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;获取用户列表&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alice@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Bob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bob@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">201</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user: UserCreate):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;创建用户&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 实际项目中应该保存到数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.model_dump()}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：子路径使用前导斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;获取用户详情&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTPException(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;用户不存在&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alice@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user: UserCreate):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;更新用户&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.model_dump()}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">204</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> delete_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;删除用户&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：嵌套路径也使用前导斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/posts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_user_posts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;获取用户的文章列表&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Post 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span></code></pre></div><h4 id="前端-api-定义" tabindex="-1">前端 API 定义 <a class="header-anchor" href="#前端-api-定义" aria-label="Permalink to &quot;前端 API 定义&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：使用常量定义，无末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> USER_API_ENDPOINTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LIST: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GET /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  CREATE: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// POST /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  DETAIL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GET /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// PUT /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  DELETE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// DELETE /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  POSTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/posts`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GET /api/v1/users/{id}/posts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;axios&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取用户列表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USER_API_ENDPOINTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LIST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> newUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USER_API_ENDPOINTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Alice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;alice@example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取用户详情</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USER_API_ENDPOINTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DETAIL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取用户的文章列表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> posts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USER_API_ENDPOINTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POSTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><strong>Vite 配置：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:8000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>前端 API 封装：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// api/client.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;axios&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 注意：在开发环境中，baseURL 使用相对路径，让 Vite proxy 处理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在生产环境中，需要配置实际的 API 地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseURL: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://api.example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  timeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// api/users.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ✅ 无末尾斜杠</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> userApi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  detail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Vue 组件中使用：</strong></p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- UserList.vue --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">li</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v-for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user in users&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> :key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user.id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {{ user.name }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ref, onMounted } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vue&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { userApi } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/api/users&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchUsers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ✅ 正确：请求路径无末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    users.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;获取用户列表失败:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onMounted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fetchUsers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p><strong>请求流程（修复后）：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 浏览器：GET http://localhost:5173/api/v1/users</span></span>
<span class="line"><span>2. Vite Proxy：转发到 http://localhost:8000/api/v1/users</span></span>
<span class="line"><span>3. FastAPI：路由匹配成功（@router.get(&quot;&quot;)）</span></span>
<span class="line"><span>4. FastAPI：返回 200 OK + 数据</span></span>
<span class="line"><span>5. Vite Proxy：返回响应给浏览器</span></span>
<span class="line"><span>6. 浏览器：收到数据，只执行了一次请求 ✅</span></span></code></pre></div><h2 id="五、验证方法" tabindex="-1">五、验证方法 <a class="header-anchor" href="#五、验证方法" aria-label="Permalink to &quot;五、验证方法&quot;">​</a></h2><h3 id="_5-1-浏览器-network-标签检查" tabindex="-1">5.1 浏览器 Network 标签检查 <a class="header-anchor" href="#_5-1-浏览器-network-标签检查" aria-label="Permalink to &quot;5.1 浏览器 Network 标签检查&quot;">​</a></h3><p><strong>检查步骤：</strong></p><ol><li>打开浏览器开发者工具（F12）</li><li>切换到 Network 标签</li><li>发起一个 API 请求（如获取用户列表）</li><li>观察请求记录</li></ol><p><strong>正常情况：</strong></p><ul><li>✅ 只有一个请求记录</li><li>✅ 状态码直接是 200/201</li><li>✅ 响应头中没有 <code>Location</code> 字段</li></ul><p><strong>异常情况：</strong></p><ul><li>❌ 有两个相同路径的请求</li><li>❌ 第一个请求状态码是 307</li><li>❌ 第一个请求的响应头中有 <code>Location</code> 字段</li></ul><h3 id="_5-2-后端代码检查" tabindex="-1">5.2 后端代码检查 <a class="header-anchor" href="#_5-2-后端代码检查" aria-label="Permalink to &quot;5.2 后端代码检查&quot;">​</a></h3><p><strong>使用 grep 搜索问题路由：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在项目根目录执行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索所有使用 &quot;/&quot; 作为根路径的路由</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.get(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.post(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.put(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.delete(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@router\.patch(&quot;/&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend/</span></span></code></pre></div><p><strong>如果找到匹配结果，说明存在问题的路由定义。</strong></p><h3 id="_5-3-使用-curl-直接测试后端" tabindex="-1">5.3 使用 curl 直接测试后端 <a class="header-anchor" href="#_5-3-使用-curl-直接测试后端" aria-label="Permalink to &quot;5.3 使用 curl 直接测试后端&quot;">​</a></h3><p><strong>使用 curl 测试（无末尾斜杠）</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试 GET 请求</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8000/api/v1/users</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试 POST 请求</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8000/api/v1/users</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;name&quot;: &quot;Alice&quot;, &quot;email&quot;: &quot;alice@example.com&quot;}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试带路径参数的请求</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8000/api/v1/users/1</span></span></code></pre></div><p><strong>检查响应：</strong></p><ul><li>✅ 正常：状态码应该是 200/201，不是 307</li><li>✅ 正常：响应头中不应该有 <code>Location</code> 字段</li><li>❌ 异常：如果看到 <code>Location</code> 头，说明有重定向</li></ul><p><strong>预期输出（正常情况）</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTP/1.1 200 OK</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content-type: application/json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content-length: 123</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: 1, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alice@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span></code></pre></div><p><strong>异常输出（有重定向）</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTP/1.1 307 Temporary Redirect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> location: http://localhost:8000/api/v1/users/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content-length: 0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><h3 id="_5-4-自动化测试" tabindex="-1">5.4 自动化测试 <a class="header-anchor" href="#_5-4-自动化测试" aria-label="Permalink to &quot;5.4 自动化测试&quot;">​</a></h3><p><strong>编写测试用例验证路由无重定向</strong>：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># tests/test_routes.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pytest</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fastapi.testclient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TestClient</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.main </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TestClient(app)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_list_users_no_redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;测试用户列表接口无重定向&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">follow_redirects</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ✅ 应该直接返回 200，不是 307</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.status_code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    assert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;location&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.headers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_create_user_no_redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;测试创建用户接口无重定向&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.post(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alice@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        follow_redirects</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ✅ 应该直接返回 201，不是 307</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.status_code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 201</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    assert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;location&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.headers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_get_user_no_redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;测试获取用户详情接口无重定向&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users/1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">follow_redirects</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ✅ 应该直接返回 200，不是 307</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.status_code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    assert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;location&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.headers</span></span></code></pre></div><p><strong>使用 pytest 运行测试</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行所有路由测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/test_routes.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 运行特定测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/test_routes.py::test_list_users_no_redirect</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><h2 id="六、常见问题" tabindex="-1">六、常见问题 <a class="header-anchor" href="#六、常见问题" aria-label="Permalink to &quot;六、常见问题&quot;">​</a></h2><h3 id="_5-1-faq" tabindex="-1">5.1 FAQ <a class="header-anchor" href="#_5-1-faq" aria-label="Permalink to &quot;5.1 FAQ&quot;">​</a></h3><p><strong>Q: 为什么子路径使用 &quot;/{id}&quot; 而不是 &quot;{id}&quot;？</strong></p><p>A: FastAPI 要求子路径必须以 <code>/</code> 开头。<code>&quot;/{id}&quot;</code> 是正确的，<code>&quot;{id}&quot;</code> 会导致路由注册失败。</p><p><strong>Q: 可以禁用 redirect_slashes 吗？</strong></p><p>A: 可以，但不推荐。设置 <code>redirect_slashes=False</code> 会导致路径不匹配时直接返回 404，而不是重定向，可能使问题更难发现。</p><p><strong>Q: 为什么 RESTful API 不使用末尾斜杠？</strong></p><p>A: 这是 RESTful API 的通用约定。大多数 API 设计（如 GitHub API、Twitter API）都不使用末尾斜杠，保持一致性有助于 API 的可预测性和可维护性。</p><p><strong>Q: 如果项目中已经有很多路由使用了 &quot;/&quot;，如何批量修复？</strong></p><p>A: 可以使用以下方法批量修复：</p><ol><li><p><strong>使用 IDE 的查找替换功能</strong>：</p><ul><li>搜索模式：<code>@router\.(get|post|put|delete|patch)\(&quot;/&quot;</code></li><li>替换为：<code>@router.$1(&quot;&quot;</code></li><li>注意：需要逐个检查，确保不会误替换子路径</li></ul></li><li><p><strong>使用脚本批量替换</strong>（谨慎使用）：</p></li></ol><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 读取文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;routers.py&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;r&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f.read()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 替换根路径的 &quot;/&quot; 为空字符串（需要精确匹配）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意：这需要根据实际情况调整正则表达式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pattern </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">@router</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">get</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">put</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">delete</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">patch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">)</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">&quot;/&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">replacement </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">@router</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">\1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">&quot;&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> re.sub(pattern, replacement, content)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 写回文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;routers.py&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;w&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    f.write(content)</span></span></code></pre></div><ol start="3"><li><strong>手动逐个修复</strong>（推荐）： <ul><li>使用 grep 查找所有使用 <code>&quot;/&quot;</code> 的路由</li><li>逐个检查并修复，确保不会影响子路径</li></ul></li></ol><p><strong>Q: 为什么在 Vite 开发环境中会出现这个问题，生产环境可能不会？</strong></p><p>A: 在开发环境中，Vite 的 proxy 会将请求转发到后端，如果后端返回 307 重定向，浏览器会自动跟随重定向，导致请求执行两次。在生产环境中，如果前端直接请求后端 API（不经过 proxy），同样会出现这个问题。建议统一修复后端路由定义，确保开发和生产环境行为一致。</p><p><strong>Q: Vite proxy 配置中的 rewrite 选项会影响这个问题吗？</strong></p><p>A: 可能会。如果使用 <code>rewrite</code> 修改了路径，可能会导致路径不匹配。建议保持路径原样转发，让后端处理路由匹配。只有在特殊需求下才使用 <code>rewrite</code>。</p><p><strong>Q: 前端使用 axios 等库时，会自动跟随重定向吗？</strong></p><p>A: 是的。大多数 HTTP 客户端库（如 axios、fetch）会自动跟随 307/308 重定向，但这会增加请求延迟。在 Vite 开发环境中，重定向后的请求仍然会经过 proxy，导致请求执行两次。建议在前后端统一路径格式，避免重定向。</p><p><strong>Q: 如何检查项目中是否存在路由重定向问题？</strong></p><p>A: 可以使用以下方法：</p><ol><li><strong>代码检查</strong>：使用 grep 搜索所有使用 <code>&quot;/&quot;</code> 作为根路径的路由</li><li><strong>运行时检查</strong>：在开发环境中测试所有 API 端点，观察 Network 标签</li><li><strong>自动化测试</strong>：编写测试用例，验证所有 API 端点不返回 307 状态码</li></ol><h2 id="七、最佳实践总结" tabindex="-1">七、最佳实践总结 <a class="header-anchor" href="#七、最佳实践总结" aria-label="Permalink to &quot;七、最佳实践总结&quot;">​</a></h2><h3 id="_6-1-后端路由定义规范" tabindex="-1">6.1 后端路由定义规范 <a class="header-anchor" href="#_6-1-后端路由定义规范" aria-label="Permalink to &quot;6.1 后端路由定义规范&quot;">​</a></h3><p><strong>核心规则：</strong></p><ul><li>✅ 根路径使用空字符串 <code>&quot;&quot;</code></li><li>✅ 子路径使用前导斜杠 <code>&quot;/{id}&quot;</code></li><li>❌ 根路径不使用 <code>&quot;/&quot;</code></li><li>❌ 子路径不使用 <code>&quot;{id}&quot;</code>（缺少前导斜杠）</li></ul><p><strong>完整示例：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fastapi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIRouter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v1/users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：根路径使用空字符串</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># POST /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PUT /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DELETE /api/v1/users</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确：子路径使用前导斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/stats&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users/stats</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/items&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GET /api/v1/users/{id}/items</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误：根路径使用 &quot;/&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/，会导致重定向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只匹配 /api/v1/users/，会导致重定向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误：子路径缺少前导斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@router.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{id}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 路由注册失败</span></span></code></pre></div><h3 id="_6-2-前端-api-路径规范" tabindex="-1">6.2 前端 API 路径规范 <a class="header-anchor" href="#_6-2-前端-api-路径规范" aria-label="Permalink to &quot;6.2 前端 API 路径规范&quot;">​</a></h3><p><strong>核心规则：</strong></p><ul><li>✅ 统一使用无末尾斜杠的路径</li><li>✅ 使用常量定义 API 基础路径</li><li>❌ 不要添加末尾斜杠</li><li>❌ 不要在路径拼接时添加多余的斜杠</li></ul><p><strong>完整示例：</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：使用常量定义，无末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> USER_API_ENDPOINTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LIST: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  CREATE: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  DETAIL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/{id}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  STATS: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/stats`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/stats</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ITEMS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/items`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/{id}/items</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 错误：添加末尾斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users/&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 会导致重定向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_ENDPOINTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LIST: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /api/v1/users/ - 会导致重定向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 错误：路径拼接时添加多余的斜杠</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/api/v1/users&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DETAIL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}//${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 双斜杠，虽然不会出错但不规范</span></span></code></pre></div><h3 id="_6-3-团队协作建议" tabindex="-1">6.3 团队协作建议 <a class="header-anchor" href="#_6-3-团队协作建议" aria-label="Permalink to &quot;6.3 团队协作建议&quot;">​</a></h3><ol><li><strong>建立代码规范</strong>：在项目文档中明确路由定义规范</li><li><strong>代码审查</strong>：在 PR 中检查路由定义是否符合规范</li><li><strong>自动化检查</strong>：使用 lint 工具或脚本检查路由定义</li><li><strong>统一前后端规范</strong>：确保前后端使用相同的路径格式</li></ol><h2 id="八、相关资源" tabindex="-1">八、相关资源 <a class="header-anchor" href="#八、相关资源" aria-label="Permalink to &quot;八、相关资源&quot;">​</a></h2><ul><li><a href="https://fastapi.tiangolo.com/tutorial/bigger-applications/" target="_blank" rel="noreferrer">FastAPI 路由文档</a></li><li><a href="https://www.starlette.io/routing/" target="_blank" rel="noreferrer">Starlette 路由文档</a></li><li><a href="https://restfulapi.net/resource-naming/" target="_blank" rel="noreferrer">RESTful API 设计规范</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-8b9a1a38 data-v-e586032c><!--[--><!--]--><div class="edit-info" data-v-e586032c><!----><div class="last-updated" data-v-e586032c><p class="VPLastUpdated" data-v-e586032c data-v-d7300fe5>最后更新时间: <time datetime="2025-12-26T06:08:44.000Z" data-v-d7300fe5></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e586032c><span class="visually-hidden" id="doc-footer-aria-label" data-v-e586032c>Pager</span><div class="pager" data-v-e586032c><a class="VPLink link pager-link prev" href="/posts/Celery%20%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97" data-v-e586032c><!--[--><span class="desc" data-v-e586032c>上一篇</span><span class="title" data-v-e586032c>Celery 异步任务队列完整指南</span><!--]--></a></div><div class="pager" data-v-e586032c><a class="VPLink link pager-link next" href="/posts/LangChain%20PGVectorStore%20%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97" data-v-e586032c><!--[--><span class="desc" data-v-e586032c>下一篇</span><span class="title" data-v-e586032c>LangChain PGVectorStore 完整指南</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><div class="giscus-container" data-v-38affe22 data-v-67f8576b><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div><footer data-v-38affe22 data-v-649c6707><div class="busuanzi" data-v-649c6707><span id="busuanzi_container_site_pv" style="display:none;"> 本站总访问量 <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span></span><span id="busuanzi_container_site_uv" style="display:none;"> 本站访客数 <span id="busuanzi_value_site_uv"></span>人 </span></div> Powered by <a href="https://github.com/helloAhao096" target="_blank" title="作者" data-v-649c6707> QianFan </a> | Copyright © 2023.3.6-2026 | MIT License </footer><button class="back-to-top" aria-label="返回顶部" type="button" data-v-38affe22 data-v-53aa58d3><svg class="back-to-top-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-v-53aa58d3><path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" data-v-53aa58d3></path></svg></button></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about.md\":\"Dzbi7_Kw\",\"gallery.md\":\"CxSyska5\",\"index.md\":\"Cm18a-_C\",\"posts_alembic 数据库迁移完整指南.md\":\"DHuD5xCb\",\"posts_celery 异步任务队列完整指南.md\":\"oWaQzgL0\",\"posts_docker 自动化安装部署、配置镜像源.md\":\"BkSo6f2J\",\"posts_fastapi 项目工程化结构设计指南.md\":\"VOwqHq1V\",\"posts_funasr 语音识别部署和使用指南.md\":\"B4JWxI4C\",\"posts_giscus评论配置.md\":\"JeKxaM6J\",\"posts_git branch 分支管理规范指南.md\":\"DXxQ2eCI\",\"posts_git commit 提交规范指南.md\":\"CAS935_C\",\"posts_gitalk配置.md\":\"EvHGJlNi\",\"posts_github action一键部署个人博客.md\":\"CZ8AmKuB\",\"posts_github action完整示例详解.md\":\"BA6KLhWH\",\"posts_gitignore 配置指南.md\":\"DHqICOHZ\",\"posts_homebrew 设置代理_国内镜像源.md\":\"DCm-0EEe\",\"posts_index.md\":\"nMMDUdX1\",\"posts_langchain pgvectorstore 完整指南.md\":\"DlbhVRw6\",\"posts_langgraph 人机环路 interrupt.md\":\"Bu0PoVbG\",\"posts_linux service服务配置.md\":\"BYu0knVn\",\"posts_linux挂载u盘拷贝文件.md\":\"NUXrRhZK\",\"posts_linux连接蓝牙设备.md\":\"yzAhKI0A\",\"posts_openspec 使用指南.md\":\"C_wu-S4V\",\"posts_osm离线地图docker服务器搭建流程.md\":\"DE5g88Qk\",\"posts_postgresql常用命令.md\":\"DpJgbLAP\",\"posts_ubuntu22.04网络配置wlan_wifi固定ip.md\":\"BWi6fhoz\",\"posts_uv python 包管理器使用指南.md\":\"DR8yY6RW\",\"posts_vitepress自定义静态文件路由.md\":\"BwG3k-nr\",\"posts_vue 3 项目工程化结构设计指南.md\":\"BCsPBeaB\",\"posts_vue_vite的api网络请求proxy设置.md\":\"rHLF6Cgb\",\"posts_vue项目vite全局静态变量配置.md\":\"Dgkg26Pt\",\"posts_不蒜子 网站计数器.md\":\"BpZZkOQW\",\"posts_全栈项目目录结构设计.md\":\"BXJUIFRl\",\"posts_前后端api路由重定向问题.md\":\"BRgYLl_6\",\"posts_千帆财富自由计划.md\":\"D3RkjHNs\",\"posts_树莓派4b配置watchdog.md\":\"l00pE3Jk\",\"posts_网站自定义鼠标事件.md\":\"Do7cFMP9\",\"posts_车机安装第三方应用.md\":\"tTIgpGnW\",\"tools.md\":\"CjFCHeA-\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"QianFan\",\"description\":\"Home of QianFan\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/QianFan.jpg\",\"lastUpdated\":{\"text\":\"最后更新时间\"},\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"outline\":{\"level\":[2,6],\"label\":\"本页目录\"},\"sidebar\":{\"/posts/\":[{\"text\":\"2026年\",\"collapsed\":false,\"items\":[{\"text\":\"Alembic 数据库迁移完整指南\",\"link\":\"/posts/Alembic 数据库迁移完整指南\"},{\"text\":\"FunASR 语音识别部署和使用指南\",\"link\":\"/posts/FunASR 语音识别部署和使用指南\"},{\"text\":\"Celery 异步任务队列完整指南\",\"link\":\"/posts/Celery 异步任务队列完整指南\"}]},{\"text\":\"2025年\",\"collapsed\":false,\"items\":[{\"text\":\"前后端API路由重定向问题\",\"link\":\"/posts/前后端API路由重定向问题\"},{\"text\":\"LangChain PGVectorStore 完整指南\",\"link\":\"/posts/LangChain PGVectorStore 完整指南\"},{\"text\":\"千帆财富自由计划\",\"link\":\"/posts/千帆财富自由计划\"},{\"text\":\"Git Branch 分支管理规范指南\",\"link\":\"/posts/Git Branch 分支管理规范指南\"},{\"text\":\"Git Commit 提交规范指南\",\"link\":\"/posts/Git Commit 提交规范指南\"},{\"text\":\"uv Python 包管理器使用指南\",\"link\":\"/posts/uv Python 包管理器使用指南\"},{\"text\":\".gitignore 配置指南\",\"link\":\"/posts/gitignore 配置指南\"},{\"text\":\"FastAPI + Vue 3 全栈项目目录结构设计指南\",\"link\":\"/posts/全栈项目目录结构设计\"},{\"text\":\"FastAPI 项目工程化结构设计指南\",\"link\":\"/posts/FastAPI 项目工程化结构设计指南\"},{\"text\":\"Vue 3 项目工程化结构设计指南\",\"link\":\"/posts/Vue 3 项目工程化结构设计指南\"},{\"text\":\"giscus 评论插件配置指南\",\"link\":\"/posts/giscus评论配置\"},{\"text\":\"OpenSpec 使用指南\",\"link\":\"/posts/OpenSpec 使用指南\"},{\"text\":\"GitHub Action完整示例详解\",\"link\":\"/posts/GitHub Action完整示例详解\"},{\"text\":\"LangGraph 人机环路 interrupt\",\"link\":\"/posts/LangGraph 人机环路 interrupt\"}]},{\"text\":\"2024年\",\"collapsed\":false,\"items\":[{\"text\":\"docker 自动化安装部署、配置镜像源\",\"link\":\"/posts/docker 自动化安装部署、配置镜像源\"},{\"text\":\"linux service服务配置\",\"link\":\"/posts/linux service服务配置\"},{\"text\":\"postgresql 常用命令\",\"link\":\"/posts/postgresql常用命令\"},{\"text\":\"Homebrew 设置代理&国内镜像源\",\"link\":\"/posts/Homebrew 设置代理&国内镜像源\"},{\"text\":\"vue&vite的api网络请求proxy设置\",\"link\":\"/posts/vue&vite的api网络请求proxy设置\"},{\"text\":\"vue项目vite全局静态变量配置\",\"link\":\"/posts/vue项目vite全局静态变量配置\"},{\"text\":\"linux连接蓝牙设备📶\",\"link\":\"/posts/linux连接蓝牙设备\"}]},{\"text\":\"2023年\",\"collapsed\":false,\"items\":[{\"text\":\"linux挂载硬盘拷贝文件\",\"link\":\"/posts/linux挂载u盘拷贝文件\"},{\"text\":\"ubuntu22.04网络配置WLAN&WIFI固定ip\",\"link\":\"/posts/ubuntu22.04网络配置WLAN&WIFI固定ip\"},{\"text\":\"树莓派4b配置watchdog\",\"link\":\"/posts/树莓派4b配置watchdog\"},{\"text\":\"osm离线地图docker服务器搭建流程\",\"link\":\"/posts/osm离线地图docker服务器搭建流程\"},{\"text\":\"车机安装第三方应用\",\"link\":\"/posts/车机安装第三方应用\"},{\"text\":\"GitHub Action一键部署个人博客\",\"link\":\"/posts/GitHub Action一键部署个人博客\"},{\"text\":\"Gitalk配置\",\"link\":\"/posts/Gitalk配置\"},{\"text\":\"vitepress自定义静态文件路由\",\"link\":\"/posts/vitepress自定义静态文件路由\"},{\"text\":\"vitepress中使用不蒜子网站计数器\",\"link\":\"/posts/不蒜子 网站计数器\"},{\"text\":\"网站自定义鼠标事件\",\"link\":\"/posts/网站自定义鼠标事件\"}]}]},\"posts\":[{\"frontMatter\":{\"title\":\"Alembic 数据库迁移完整指南\",\"description\":\"基于实际项目经验，提供 Alembic 数据库迁移的完整实战指南。涵盖从零初始化、异步模式配置、开发工作流、生产环境部署到常见坑点解决方案。\",\"date\":\"2026-02-03 14:07:00\",\"tags\":[\"Alembic\",\"SQLAlchemy\",\"Python\"]},\"regularPath\":\"/posts/Alembic 数据库迁移完整指南.html\"},{\"frontMatter\":{\"title\":\"FunASR 语音识别部署和使用指南\",\"description\":\"FunASR 离线文件转写服务 Docker 部署指南和 WebSocket 通信协议详解\",\"date\":\"2026-01-27 00:00:00\",\"tags\":[\"ASR\"]},\"regularPath\":\"/posts/FunASR 语音识别部署和使用指南.html\"},{\"frontMatter\":{\"title\":\"Celery 异步任务队列完整指南\",\"description\":\"Celery 异步任务队列实战指南，包含 FastAPI 集成、数据库连接管理、异步任务编写、常见问题解决方案和性能优化建议。基于实际项目经验，专注于生产环境最佳实践。\",\"date\":\"2026-01-19 15:16:00\",\"tags\":[\"Celery\",\"Python\"]},\"regularPath\":\"/posts/Celery 异步任务队列完整指南.html\"},{\"frontMatter\":{\"title\":\"前后端API路由重定向问题\",\"description\":\"解决 Vue + Vite 项目中遇到的 API 请求执行两遍的问题。深入分析 Vite proxy 配置与 FastAPI 路由斜杠不匹配导致的 307 重定向问题，提供完整的排查方法和解决方案。\",\"date\":\"2025-12-25 17:37:03\",\"tags\":[\"FastAPI\",\"Python\",\"Vue\"]},\"regularPath\":\"/posts/前后端API路由重定向问题.html\"},{\"frontMatter\":{\"title\":\"LangChain PGVectorStore 完整指南\",\"description\":\"LangChain PGVectorStore 实战指南，包含 FastAPI 集成、数据库连接管理、Embedding API 兼容性配置、常见问题解决方案和性能优化建议。基于实际项目经验，专注于生产环境最佳实践。\",\"date\":\"2025-12-12 18:04:14\",\"tags\":[\"RAG\",\"LangChain\",\"pgvector\",\"FastAPI\"]},\"regularPath\":\"/posts/LangChain PGVectorStore 完整指南.html\"},{\"frontMatter\":{\"title\":\"千帆财富自由计划\",\"description\":\"个人长期定投与价值投思路，基于价值投资理念的ETF资产配置与定投补仓策略优化思路\",\"date\":\"2025-12-03 17:43:23\",\"tags\":[\"投资理财\",\"价值投资\",\"资产配置\"]},\"regularPath\":\"/posts/千帆财富自由计划.html\"},{\"frontMatter\":{\"title\":\"Git Branch 分支管理规范指南\",\"description\":\"统一的 Git 分支命名和管理规范，包括分支类型、命名规则、分支策略（Git Flow、GitHub Flow）、功能分支管理、代码审查流程等，提升团队协作效率和代码质量。\",\"date\":\"2025-12-01 15:43:56\",\"tags\":[\"Git\",\"工程化\"]},\"regularPath\":\"/posts/Git Branch 分支管理规范指南.html\"},{\"frontMatter\":{\"title\":\"Git Commit 提交规范指南\",\"description\":\"统一的 Git Commit 提交信息规范，提升代码审查效率、便于生成变更日志、支持后续集成自动化流程。基于 Conventional Commits 标准，提供完整的提交信息格式、类型定义和最佳实践。\",\"date\":\"2025-12-01 15:26:13\",\"tags\":[\"Git\",\"工程化\"]},\"regularPath\":\"/posts/Git Commit 提交规范指南.html\"},{\"frontMatter\":{\"title\":\"uv Python 包管理器使用指南\",\"description\":\"uv 是由 Astral 开发的极快的 Python 包和项目管理工具，用于替代 pip、pip-tools、pipx、poetry、pyenv、twine、virtualenv 等工具。本文档介绍 uv 的基本概念、安装方法和常用操作。\",\"date\":\"2025-12-01 15:03:37\",\"tags\":[\"Python\",\"工程化\"]},\"regularPath\":\"/posts/uv Python 包管理器使用指南.html\"},{\"frontMatter\":{\"title\":\".gitignore 配置指南\",\"description\":\"通用的、可复用、可标准化的 .gitignore 配置指南，适用于各种类型的项目，提供分层管理策略和最佳实践\",\"date\":\"2025-12-01 14:43:20\",\"tags\":[\"Git\",\"工程化\"]},\"regularPath\":\"/posts/gitignore 配置指南.html\"},{\"frontMatter\":{\"title\":\"FastAPI + Vue 3 全栈项目目录结构设计指南\",\"description\":\"基于实际项目经验，设计前后端分离的全栈项目目录结构，支持开发模式（热重载）和生产模式（容器化部署），提供最小可维护的核心服务配置和可扩展的可选服务集成方案\",\"date\":\"2025-12-01 14:28:48\",\"tags\":[\"FastAPI\",\"Vue\",\"全栈开发\",\"工程化\",\"Docker\"]},\"regularPath\":\"/posts/全栈项目目录结构设计.html\"},{\"frontMatter\":{\"title\":\"FastAPI 项目工程化结构设计指南\",\"description\":\"基于实际项目经验，总结 FastAPI 后端项目的工程化目录架构设计原则和最佳实践，提供可复用的、解耦的工程化结构方案\",\"date\":\"2025-11-28 15:23:23\",\"tags\":[\"FastAPI\",\"Python\",\"后端开发\",\"工程化\"]},\"regularPath\":\"/posts/FastAPI 项目工程化结构设计指南.html\"},{\"frontMatter\":{\"title\":\"Vue 3 项目工程化结构设计指南\",\"description\":\"基于实际项目经验，总结 Vue 3 前端项目的工程化目录架构设计原则和最佳实践，提供可复用的、解耦的工程化结构方案。包含 Store + Composable + Hooks 核心架构模式和混合模式（core/shared/modules）三层结构设计。\",\"date\":\"2025-11-28 13:24:01\",\"tags\":[\"Vue\",\"前端开发\",\"工程化\"]},\"regularPath\":\"/posts/Vue 3 项目工程化结构设计指南.html\"},{\"frontMatter\":{\"title\":\"giscus 评论插件配置指南\",\"description\":\"从启用 GitHub Discussions 到在 VitePress 中完成 giscus 评论集成的完整流程\",\"date\":\"2025-11-26 18:29:00\",\"tags\":[\"VitePress\",\"博客搭建\"]},\"regularPath\":\"/posts/giscus评论配置.html\"},{\"frontMatter\":{\"title\":\"OpenSpec 使用指南\",\"description\":\"OpenSpec 规范驱动开发工具快速指南，帮助 AI 编程助手与开发者对齐需求\",\"date\":\"2025-11-26 16:29:00\",\"tags\":[\"AI工具\",\"工程化\"]},\"regularPath\":\"/posts/OpenSpec 使用指南.html\"},{\"frontMatter\":{\"title\":\"GitHub Action完整示例详解\",\"description\":\"GitHub Action 完整工作流程详解、配置示例、最佳实践\",\"date\":\"2025-11-16 00:00:00\",\"tags\":[\"GitHub\",\"CI/CD\"]},\"regularPath\":\"/posts/GitHub Action完整示例详解.html\"},{\"frontMatter\":{\"title\":\"LangGraph 人机环路 interrupt\",\"description\":\"LangGraph 人机环路 interrupt 完整使用指南\",\"date\":\"2025-10-03 00:00:00\",\"tags\":[\"LangGraph\",\"AI工具\"]},\"regularPath\":\"/posts/LangGraph 人机环路 interrupt.html\"},{\"frontMatter\":{\"title\":\"docker 自动化安装部署、配置镜像源\",\"description\":\"docker 自动化安装部署、配置镜像源\",\"date\":\"2024-11-18 00:00:00\",\"tags\":[\"Docker\",\"Ubuntu\",\"系统配置\"]},\"regularPath\":\"/posts/docker 自动化安装部署、配置镜像源.html\"},{\"frontMatter\":{\"title\":\"linux service服务配置\",\"description\":\"linux service服务配置\",\"date\":\"2024-07-18 00:00:00\",\"tags\":[\"Linux\",\"系统配置\"]},\"regularPath\":\"/posts/linux service服务配置.html\"},{\"frontMatter\":{\"title\":\"postgresql 常用命令\",\"description\":\"postgresql 常用命令\",\"date\":\"2024-07-01 00:00:00\",\"tags\":[\"PostgreSQL\",\"数据库\"]},\"regularPath\":\"/posts/postgresql常用命令.html\"},{\"frontMatter\":{\"title\":\"Homebrew 设置代理&国内镜像源\",\"description\":\"Homebrew 设置代理&国内镜像源\",\"date\":\"2024-05-10 00:00:00\",\"tags\":[\"macOS\",\"系统配置\"]},\"regularPath\":\"/posts/Homebrew 设置代理&国内镜像源.html\"},{\"frontMatter\":{\"title\":\"vue&vite的api网络请求proxy设置\",\"description\":\"vue&vite的api网络请求proxy设置\",\"date\":\"2024-05-10 00:00:00\",\"tags\":[\"Vue\",\"前端开发\"]},\"regularPath\":\"/posts/vue&vite的api网络请求proxy设置.html\"},{\"frontMatter\":{\"title\":\"vue项目vite全局静态变量配置\",\"description\":\"vue项目vite全局静态变量配置\",\"date\":\"2024-05-10 00:00:00\",\"tags\":[\"Vue\",\"前端开发\"]},\"regularPath\":\"/posts/vue项目vite全局静态变量配置.html\"},{\"frontMatter\":{\"title\":\"linux连接蓝牙设备📶\",\"description\":\"linux连接蓝牙设备\",\"date\":\"2024-01-23 00:00:00\",\"tags\":[\"Linux\",\"系统配置\"]},\"regularPath\":\"/posts/linux连接蓝牙设备.html\"},{\"frontMatter\":{\"title\":\"linux挂载硬盘拷贝文件\",\"description\":\"linux挂载硬盘拷贝文件\",\"date\":\"2023-12-18 00:00:00\",\"tags\":[\"Linux\",\"系统配置\"]},\"regularPath\":\"/posts/linux挂载u盘拷贝文件.html\"},{\"frontMatter\":{\"title\":\"ubuntu22.04网络配置WLAN&WIFI固定ip\",\"description\":\"ubuntu22.04网络配置WLAN&WIFI固定ip\",\"date\":\"2023-12-08 00:00:00\",\"tags\":[\"Ubuntu\",\"系统配置\"]},\"regularPath\":\"/posts/ubuntu22.04网络配置WLAN&WIFI固定ip.html\"},{\"frontMatter\":{\"title\":\"树莓派4b配置watchdog\",\"description\":\"树莓派4b(ubuntu)配置watchdog防止系统卡死\",\"date\":\"2023-12-08 00:00:00\",\"tags\":[\"Linux\",\"Ubuntu\",\"系统配置\"]},\"regularPath\":\"/posts/树莓派4b配置watchdog.html\"},{\"frontMatter\":{\"title\":\"osm离线地图docker服务器搭建流程\",\"description\":\"osm离线地图docker服务器搭建流程\",\"date\":\"2023-12-07 00:00:00\",\"tags\":[\"Docker\",\"系统配置\"]},\"regularPath\":\"/posts/osm离线地图docker服务器搭建流程.html\"},{\"frontMatter\":{\"title\":\"车机安装第三方应用\",\"description\":\"在所有安卓车机上安装第三方应用\",\"date\":\"2023-11-02 00:00:00\",\"tags\":[\"汽车\"]},\"regularPath\":\"/posts/车机安装第三方应用.html\"},{\"frontMatter\":{\"title\":\"GitHub Action一键部署个人博客\",\"description\":\"GitHub Action 部署 个人博客 踩坑 教程\",\"date\":\"2023-03-13 00:00:00\",\"tags\":[\"GitHub\",\"博客搭建\",\"CI/CD\"]},\"regularPath\":\"/posts/GitHub Action一键部署个人博客.html\"},{\"frontMatter\":{\"title\":\"Gitalk配置\",\"description\":\"vitepress gitalk 配置 总结\",\"date\":\"2023-03-13 00:00:00\",\"tags\":[\"博客搭建\"]},\"regularPath\":\"/posts/Gitalk配置.html\"},{\"frontMatter\":{\"title\":\"vitepress自定义静态文件路由\",\"description\":\"vitepress自定义静态文件路由\",\"date\":\"2023-03-11 00:00:00\",\"tags\":[\"VitePress\",\"博客搭建\"]},\"regularPath\":\"/posts/vitepress自定义静态文件路由.html\"},{\"frontMatter\":{\"title\":\"vitepress中使用不蒜子网站计数器\",\"description\":\"在博客中添加网站计数器\",\"date\":\"2023-03-07 00:00:00\",\"tags\":[\"Vue\",\"博客搭建\"]},\"regularPath\":\"/posts/不蒜子 网站计数器.html\"},{\"frontMatter\":{\"title\":\"网站自定义鼠标事件\",\"description\":\"好看的彩虹鼠标🌈\",\"date\":\"2023-03-07 00:00:00\",\"tags\":[\"博客搭建\"]},\"regularPath\":\"/posts/网站自定义鼠标事件.html\"}],\"pageSize\":5,\"postLength\":34,\"nav\":[{\"text\":\"🏡 首页\",\"link\":\"/\",\"activeMatch\":\"^/$\"},{\"text\":\"📚 博客\",\"link\":\"/posts/\",\"activeMatch\":\"^/posts/\"},{\"text\":\"👤 关于\",\"link\":\"/about\",\"activeMatch\":\"^/about\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/helloAhao096\"},{\"icon\":{\"svg\":\"<svg role=\\\"img\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\">\\n            <path d=\\\"M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z\\\" ></path>\\n            </svg>\"},\"link\":\"mailto:helloahao@icloud.com\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>